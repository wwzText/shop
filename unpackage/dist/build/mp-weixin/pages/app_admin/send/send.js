(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/app_admin/send/send"],{"4c5f":function(e,i,t){},"8b09":function(e,i,t){"use strict";var s;t.d(i,"b",(function(){return n})),t.d(i,"c",(function(){return d})),t.d(i,"a",(function(){return s}));var n=function(){var e=this,i=e.$createElement;e._self._c},d=[]},"8bad":function(e,i,t){"use strict";t.r(i);var s=t("8de5"),n=t.n(s);for(var d in s)"default"!==d&&function(e){t.d(i,e,(function(){return s[e]}))}(d);i["default"]=n.a},"8de5":function(e,i,t){"use strict";(function(e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=t("2f62");function n(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),t.push.apply(t,s)}return t}function d(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?n(Object(t),!0).forEach((function(i){r(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}))}return e}function r(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}var o={data:function(){return{express_no:"",express:"",customer_name:"",express_content:"",code:"",words:"",list:[],detail:{},dialog:!1,iphone_x:!1,id:"",index:0,newIndex:0,value:0,is_express:-2,is_send:0,order_refund_id:0,express_single:{},city:{cityList:[],deliveryId:null,delivery:"",cityServiceList:[],cityServiceId:null,cityService:"",isPreview:0,fee:0,name:"",delivery_no:""}}},computed:d({},(0,s.mapState)({userInfo:function(e){return e.user.info},adminImg:function(e){return e.mallConfig.__wxapp_img.app_admin}})),methods:{chooseAddress:function(e){e.choose=!e.choose,this.$forceUpdate()},toggleExpress:function(e){if(this.is_express=e,2==this.detail.send_type)for(var i in this.list=2==e?this.city.cityList:this.city.cityServiceList,this.list)2==this.is_express?this.list[i].id==this.city.deliveryId&&(this.index=+i,this.newIndex=+i):this.list[i].id==this.city.cityServiceId&&(this.index=+i,this.newIndex=+i)},bindChange:function(e){this.newIndex=e.detail.value[0]},toPick:function(e){var i=this;1==e?(i.customer_name="",i.newIndex=i.index):i.newIndex=i.index,setTimeout((function(){i.dialog=!i.dialog}))},closeDialog:function(e){1==e?(this.index=this.newIndex,2==this.detail.send_type?2==this.is_express?(this.city.delivery="("+this.list[this.index].id+")"+this.list[this.index].name,this.city.deliveryId=this.list[this.index].id):(this.city.cityService="("+this.list[this.index].id+")"+this.list[this.index].name,this.city.cityServiceId=this.list[this.index].id,this.city.isPreview=0):this.express=this.list[this.newIndex].name):this.newIndex=this.index,this.dialog=!this.dialog},getExpressNo:function(){var i=this;e.showLoading({title:"加载中..."}),i.$request({url:i.$api.app_admin.print,data:{express:i.express,code:i.code,order_id:i.id}}).then((function(t){e.hideLoading(),0==t.code?(i.express_no=t.data.Order.LogisticCode,i.express_single=t.data.express_single):e.showToast({title:t.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading()}))},getExpress:function(){var i=this;e.showLoading({title:"加载中..."}),i.$request({url:i.$api.app_admin.express}).then((function(t){e.hideLoading(),0==t.code?(i.list=t.data.list,i.getList()):e.showToast({title:t.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading()}))},getList:function(){var i=this,t=this;e.showLoading({title:"加载中..."}),t.$request({url:t.$api.app_admin.detail,data:{order_id:t.id},method:"post"}).then((function(s){if(e.hideLoading(),0==s.code){for(var n in t.detail=s.data.order,2==i.detail.send_type?(t.getDelivery(),t.is_express=2):t.is_express=1,t.detail.detail)t.detail.detail[n].choose=!0;t.detail.detailExpress.length>0&&t.detail.detail.forEach((function(e){for(var i in t.detail.detailExpress)for(var s in t.detail.detailExpress[i].expressRelation)t.detail.detailExpress[i].expressRelation[s].order_detail_id==e.id&&(e.choose=2)})),t.is_send>0?(t.express=s.data.order.express,t.express_no=s.data.order.express_no,t.customer_name=s.data.order.customer_name,t.code="",t.words=s.data.order.merchant_remark,s.data.order.code>0&&(t.code=s.data.order.code)):t.express=t.list[0].name}else e.showToast({title:s.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading()}))},saveAddress:function(i){var t=this;if(1!=t.is_express||t.express_no){var s=t.getIdList();if(0!=s.length||0!=t.order_refund_id){e.showLoading({title:"提交中..."});var n={is_express:1,order_id:t.id,express_no:t.express_no,express:t.express,code:t.code,customer_name:t.customer_name,merchant_remark:t.words,express_content:"",order_detail_id:JSON.stringify(s),express_single_id:t.express_single.id?t.express_single.id:0};0==t.is_express&&(n={is_express:2,order_id:t.id,express_content:t.express_content,order_detail_id:JSON.stringify(s)}),t.order_refund_id>0?t.$request({url:t.$api.app_admin.refund_handle,method:"POST",data:{is_express:1,type:2,is_agree:1,order_refund_id:t.order_refund_id,express_no:t.express_no,express:t.express,merchant_remark:t.words}}).then((function(i){if(e.hideLoading(),0==i.code){var t=i.msg;e.showToast({title:t,duration:1e3,icon:"success",mask:!1}),setTimeout((function(){e.navigateBack()}),500)}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading(),e.showToast({title:i,icon:"none",duration:1e3})})):t.$request({url:t.$api.app_admin.send,method:"POST",data:n}).then((function(i){if(e.hideLoading(),0==i.code){var s=i.msg;2==t.is_send&&(s="修改成功"),e.showToast({title:s,duration:1e3,icon:"success",mask:!1}),setTimeout((function(){e.navigateBack()}),500)}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading(),e.showToast({title:i,icon:"none",duration:1e3})}))}else e.showToast({title:"请选择发货商品",icon:"none",duration:1e3})}else e.showToast({title:"快递单号不得为空",icon:"none",duration:1e3})},getIdList:function(){var e=this,i=[];for(var t in e.detail.detail)e.detail.detail[t].choose&&2!=e.detail.detail[t].choose&&i.push(e.detail.detail[t].id);return i},getDelivery:function(){var i=this,t=this;t.$request({url:t.$api.app_admin.delivery}).then((function(s){if(0===s.code){i.city.cityList=s.data.list,i.city.deliveryId=s.data.list[0].id,i.city.delivery="("+s.data.list[0].id+")"+s.data.list[0].name;var n=s.data.city_service_list,d=[];n.forEach((function(e,i){("第三方"==e.service_type||"wxapp"==t.detail.platform&&"微信"==e.service_type)&&d.push(e)})),i.city.cityServiceList=d,i.city.cityServiceId=d[0].id,i.city.cityService="("+d[0].id+")"+d[0].name,2==i.detail.send_type&&(i.list=i.city.cityList,i.is_express=2)}else e.showToast({title:s.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading()}))},citySend:function(){var i,t=this;if(2==t.detail.send_type){e.showLoading({title:"加载中..."});var s=t.getIdList();if(0==s.length&&0==t.order_refund_id)return void e.showToast({title:"请选择发货商品",icon:"none",duration:1e3});i={is_express:t.is_express,words:"",order_id:t.detail.id,order_detail_id:JSON.stringify(s),city_service:t.city.cityService,is_preview:t.city.isPreview?0:1,delivery_no:t.city.delivery_no},2==t.detail.send_type&&(i.man=t.city.delivery),t.$request({url:t.$api.app_admin.send,data:i,method:"post"}).then((function(i){if(e.hideLoading(),0===i.code){var s=i.data;s&&1==s.preview_success?(t.city.fee=s.fee,t.city.isPreview=1,t.city.name=s.name,t.city.isPreview=1,t.city.delivery_no=s.delivery_no):setTimeout((function(){e.navigateBack()}),500),e.showToast({title:i.msg,type:"success",mask:!1,duration:2e3})}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(i){e.hideLoading(),e.showToast({title:i,icon:"none",duration:1e3})}))}}},onLoad:function(i){var t=this;e.getSystemInfo({success:function(e){(e.model.indexOf("iPhone X")>-1||e.model.indexOf("iPhone 11")>-1||e.model.indexOf("iPhone11")>-1||e.model.indexOf("iPhone12")>-1||e.model.indexOf("Unknown Device")>-1)&&(t.iphone_x=!0)}}),i.id>0&&(t.id=i.id),i.order_refund_id>0&&(t.order_refund_id=i.order_refund_id),0==i.send_type?t.getExpress():(e.showLoading({title:"加载中..."}),t.getList()),i.is_send>0&&(t.is_send=i.is_send)}};i.default=o}).call(this,t("543d")["default"])},a364:function(e,i,t){"use strict";var s=t("4c5f"),n=t.n(s);n.a},b150:function(e,i,t){"use strict";(function(e){t("b8bc");s(t("66fd"));var i=s(t("f4b1"));function s(e){return e&&e.__esModule?e:{default:e}}e(i.default)}).call(this,t("543d")["createPage"])},f4b1:function(e,i,t){"use strict";t.r(i);var s=t("8b09"),n=t("8bad");for(var d in n)"default"!==d&&function(e){t.d(i,e,(function(){return n[e]}))}(d);t("a364");var r,o=t("f0c5"),a=Object(o["a"])(n["default"],s["b"],s["c"],!1,null,"646164d7",null,!1,s["a"],r);i["default"]=a.exports}},[["b150","common/runtime","common/vendor"]]]);