(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/video"],{"105f":function(t,i,e){"use strict";(function(t){e("b8bc");s(e("66fd"));var i=s(e("af0a"));function s(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("543d")["createPage"])},"19c4":function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=o(e("a34a")),r=e("2f62"),n=o(e("674b"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,i){var e;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=h(t))||i&&t&&"number"===typeof t.length){e&&(t=e);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==e.return||e.return()}finally{if(a)throw n}}}}function h(t,i){if(t){if("string"===typeof t)return c(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,i):void 0}}function c(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,s=new Array(i);e<i;e++)s[e]=t[e];return s}function u(t,i,e,s,r,n,o){try{var a=t[n](o),h=a.value}catch(c){return void e(c)}a.done?i(h):Promise.resolve(h).then(s,r)}function d(t){return function(){var i=this,e=arguments;return new Promise((function(s,r){var n=t.apply(i,e);function o(t){u(n,s,r,o,a,"next",t)}function a(t){u(n,s,r,o,a,"throw",t)}o(void 0)}))}}function l(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function p(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?l(Object(e),!0).forEach((function(i){g(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}function g(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}var m=function(){e.e("components/page-component/goods/app-goods-video").then(function(){return resolve(e("32ea"))}.bind(null,e)).catch(e.oe)},f=function(){e.e("components/page-component/app-attr/app-attr").then(function(){return resolve(e("0e1c"))}.bind(null,e)).catch(e.oe)},_=function(){e.e("components/basic-component/app-iphone-x/app-iphone-x").then(function(){return resolve(e("5e0d"))}.bind(null,e)).catch(e.oe)},b=function(){e.e("components/page-component/app-pt-attr/app-pt-attr").then(function(){return resolve(e("69a6"))}.bind(null,e)).catch(e.oe)},v={components:{videoNew:m,appPtAttr:b,"app-attr":f,"app-iphone-x":_},data:function(){return{buyText:"立即购买",sign:"",cartShow:1,plugin:"",buyBool:!1,previewUrl:"",submitUrl:"",show_pt:!1,pt:!0,selectGroupAttrId:-1,pintuan_groups:[],appAttr:{},translateX:"10",height:"667px",cur_index:null,width:"",sysheight:0,containerStyle:"transform:translateY(0px)",distance:0,listTouchStartY:0,listTouchDirection:null,scroll:!1,videoList:[],clicktime:0,goodBool:!1,goods_list:[],page:1,goods_id:0,show:0,item:null,selectAttr:{},attrGroup:[],ne:0,pre:0,is_show_buy:!0,is_share:0,addText:"",ptAttr:{},ptId:0,getResult:null}},computed:p(p(p(p({},(0,r.mapGetters)("iPhoneX",{getEmpty:"getEmpty"})),(0,r.mapGetters)("mallConfig",{getTheme:"getTheme"})),(0,r.mapState)("gift",{theme:function(t){return t.theme}})),{},{themeObject:function(){return"gift"===this.sign?{back:this.theme+"-background",userTheme:this.theme,color:this.theme+"-color",backO:this.theme+"-background-o",backP:this.theme+"-background-p"}:{back:this.getTheme+"-m-back "+this.getTheme,backP:this.getTheme+"-m-back-p "+this.getTheme,backO:this.getTheme+"-m-back-o "+this.getTheme,theme:this.getTheme,color:this.getTheme+"-m-text "+this.getTheme,sBack:this.getTheme+"-s-back "+this.getTheme,border:this.getTheme+"-m-border "+this.getTheme}}}),onLoad:function(i){var e=this;switch(this.goods_id=i.goods_id,this.sign=i.sign,this.is_share=i.is_share,this.sign){case"advance":this.cartShow=0,this.buyText="支付定金",this.buyBool=!0;break;case"booking":this.cartShow=0,this.buyText="立即预约",this.plugin="booking",this.submitUrl=this.$api.book.order_submit,this.previewUrl=this.$api.book.order_preview;break;case"miaosha":this.addText="加入购物车",this.submitUrl=this.$api.miaosha.order_submit,this.previewUrl=this.$api.miaosha.order_preview;break;case"pintuan":this.$request({url:this.$api.pt.detail,data:{id:this.goods_id,group_id:0}}).then((function(t){e.item=t.data.detail,e.cartShow=t.data.detail.pintuanGoods.is_alone_buy,e.ptAttr=JSON.parse(JSON.stringify(t.data.detail.attr)),e.ptId=JSON.parse(JSON.stringify(t.data.detail.id)),e.selectGroupAttrId=e.item.groups[0].groups.id,e.item.attr=e.item.groups[0].attr,e.item.id=e.item.groups[0].groups.goods_id}));break;case"integral_mall":this.cartShow=0,this.buyText="立即兑换",this.submitUrl=this.$api.integral_mall.order_submit,this.previewUrl=this.$api.integral_mall.order_preview;break;case"step":this.cartShow=0,this.buyText="立即兑换",this.submitUrl=this.$api.step.order_submit,this.previewUrl=this.$api.step.order_preview;break;case"gift":this.cartShow=0,this.buyBool=!0,this.buyText="加入礼包",this.$request({url:this.$api.gift.config,method:"get"}).then((function(t){0===t.code&&e.$store.commit("gift/setTheme",Number(t.data.theme.id))}));break;case"mch":this.addText="加入购物车",this.submitUrl=this.$api.mch.order_submit,this.previewUrl=this.$api.mch.order_preview;break;case"pick":this.addText="加入凑单池",this.is_show_buy=!1;break;case"exchange":this.cartShow=0,this.submitUrl=this.$api.exchange.order_submit,this.previewUrl=this.$api.exchange.order_preview;break;case"community":this.addText="加入购物车",this.is_show_buy=!1;break;default:this.addText="加入购物车";break}this.getVideo(i.goods_id);var s=t.getSystemInfoSync();this.height="".concat(s.windowHeight,"px"),this.width="".concat(s.windowWidth,"px"),this.sysheight=s.windowHeight},onHide:function(){this.videoList[this.cur_index].flag=!1,clearTimeout(this.getResult)},onShow:function(){null!==this.cur_index&&(this.videoList[this.cur_index].flag=!0)},methods:{buyClick:function(t){(0,n.default)(t,this.sign,this,this.goods_list[this.cur_index])},submit:function(){var i=this.item,e=this.appAttr.number,s=this.selectAttr;return s?e<=0?(t.showModal({title:"提示",content:"商品数量不能为0",showCancel:!1}),!1):!!i:(t.showModal({title:"提示",content:"请先选择规格",showCancel:!1}),!1)},onAttr:function(t){this.selectAttr=t},specification:function(t){this.attrGroup=t.attr_groups,"pintuan"===this.sign?(this.item=t,this.cartShow=t.pintuanGoods.is_alone_buy,this.show_pt=!0,this.ptAttr=JSON.parse(JSON.stringify(t.attr)),this.ptId=JSON.parse(JSON.stringify(t.id)),this.selectGroupAttrId=t.groups[0].groups.id,this.item.id=t.groups[0].groups.goods_id,this.item.attr=t.groups[0].attr,this.show=Math.random()):(this.show=Math.random(),this.item=t)},setGroupAttrID:function(t){this.selectGroupAttrId=t.groups.id,this.selectAttr=null,this.item.attr=t.attr,this.item.id=t.groups.goods_id},attr:function(t){this.appAttr=t},buy:function(){if(!this.submit())return!1;var i=this.item,e=this.appAttr.number,s=this.selectAttr,r=s.id,n=[];for(var o in s.attr_list)n.push({attr_id:s.attr_list[o].attr_id,attr_group_id:s.attr_list[o].attr_group_id});var a=[],h={mch_id:i.mch_id?i.mch_id:0,pintuan_order_id:0,pintuan_group_id:0,goods_list:[]};h.goods_list.push({id:i.id,attr:n,num:e,cat_id:0,goods_attr_id:r}),a.push(h),t.navigateTo({url:"/pages/order-submit/order-submit?mch_list=".concat(JSON.stringify(a),"&preview_url=").concat(encodeURIComponent(this.$api.pt.order_preview),"&submit_url=").concat(encodeURIComponent(this.$api.pt.order_submit))})},individual:function(){this.pt?(this.pt=!1,this.selectAttr={},this.item.attr=this.ptAttr,this.item.id=this.ptId):0===Object.keys(this.selectAttr).length?t.showToast({title:"请选择规格",icon:"none"}):this.buy()},multiplayer:function(){if(this.pt){if(this.selectAttr&&0===Object.keys(this.selectAttr).length)t.showToast({title:"请选择规格",icon:"none"});else if(this.selectAttr&&Object.keys(this.selectAttr).length>0){for(var i=this.item.mch_id,e=[],s={id:this.item.id,attr:[],num:this.appAttr.number,goods_attr_id:this.selectAttr.id,cart_id:0},r=0;r<this.selectAttr.attr_list.length;r++){var n={attr_id:this.selectAttr.attr_list[r].attr_id,attr_group_id:this.selectAttr.attr_list[r].attr_group_id};s.attr.push(n)}e.push({mch_id:i,pintuan_order_id:0,pintuan_group_id:this.selectGroupAttrId,goods_list:[s]}),t.navigateTo({url:"/pages/order-submit/order-submit?mch_list=".concat(JSON.stringify(e),"&preview_url=").concat(encodeURIComponent(this.$api.pt.order_preview),"&submit_url=").concat(encodeURIComponent(this.$api.pt.order_submit),"&order_page_url=/plugins/pt/order/order&plugin=pt")})}}else this.selectAttr={},this.pt=!0,this.selectGroupAttrId=this.item.groups[0].groups.id,this.item.attr=this.item.groups[0].attr,this.item.id=this.item.groups[0].groups.goods_id},getVideo:function(){var t=this;return d(s.default.mark((function i(){var e,r,n,o,h;return s.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$request({url:t.$api.goods.goods_video_list,method:"get",data:{goodsId:t.goods_id,page:t.page,limit:3}});case 2:if(e=i.sent,0===e.code){r=e.data.list,n=a(r);try{for(n.s();!(o=n.n()).done;)h=o.value,t.videoList.push({video_id:h.id,video_url:h.video_url,flag:!1}),t.goods_list.push(h)}catch(s){n.e(s)}finally{n.f()}null==t.cur_index&&(t.cur_index=0),t.$nextTick().then((function(){t.videoList[t.cur_index].flag=!0}))}case 4:case"end":return i.stop()}}),i)})))()},routeGo:function(i){t.navigateTo({url:i})},close:function(){var i=this.goods_list[this.cur_index].page_url;this.is_share&&(i+="&is_share=1"),t.redirectTo({url:i})},clickVideo:function(t){if(this.goodBool=!1,this.clicktime>0&&t.timeStamp-this.clicktime<200)clearTimeout(this.han);else{var i=this;this.han=setTimeout((function(){i.videoList[i.cur_index].flag=!i.videoList[i.cur_index].flag}),200)}this.clicktime=t.timeStamp},ListTouchStart:function(t){this.listTouchStartY=t.changedTouches[0].pageY},ListTouchMove:function(t){this.listTouchDirection=this.listTouchStartY-t.changedTouches[0].pageY>10?-1:0,this.listTouchDirection=t.changedTouches[0].pageY-this.listTouchStartY>10?1:this.listTouchDirection;var i=this.distance+t.changedTouches[0].pageY-this.listTouchStartY;i>0||Math.abs(this.listTouchStartY-t.changedTouches[0].pageY)<2&&(this.listTouchDirection=null)},ListTouchEnd:function(t){this.handelVideo(t)},handelVideo:function(){if((0!=this.cur_index||1!=this.listTouchDirection)&&(this.translateX=10,!this.scroll&&this.listTouchDirection)){var t=this.listTouchDirection*this.sysheight+this.distance;if(!(t>0||t<-this.sysheight*(this.videoList.length-1))){var i,e=a(this.videoList);try{for(e.s();!(i=e.n()).done;){var s=i.value;s.flag=!1}}catch(r){e.e(r)}finally{e.f()}this.animate(t,this.listTouchDirection),this.cur_index=this.cur_index-this.listTouchDirection,this.videoList[this.cur_index].flag=!0,this.videoList.length==this.cur_index+1&&(this.page++,this.getVideo()),this.listTouchDirection=null}}},animate:function(t,i){var e=this,s=this.distance;return new Promise((function(r,n){e.scroll=!0;var o=setInterval((function(){-1===i&&t<s||1===i&&t>s?(s+=100*i,e.containerStyle="transform:translateY(".concat(s,"px)")):(clearInterval(o),s=t,e.distance=t,e.containerStyle="transform:translateY(".concat(s,"px)"),e.scroll=!1,r())}),20)}))},previous:function(){var t=this;if(0!==this.cur_index){var i,e=a(this.videoList);try{for(e.s();!(i=e.n()).done;){var s=i.value;s.flag=!1}}catch(r){e.e(r)}finally{e.f()}this.distance=this.distance+this.sysheight,this.cur_index=this.cur_index-1,this.containerStyle="transform:translateY(".concat(this.distance,"px)"),clearTimeout(this.pre),this.pre=setTimeout((function(){t.videoList[t.cur_index].flag=!0}),300)}},add:function(i,e){var r=this;return d(s.default.mark((function n(){var o,a,h;return s.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if("pick"!==r.sign){s.next=11;break}if(0!==r.item.activity_id){s.next=5;break}t.showToast({title:"活动不存在",icon:"none"}),s.next=9;break;case 5:return s.next=7,r.$request({url:r.$api.pick.add,data:{goods_id:i.goods_id,attr:i.id,num:e,pick_activity_id:r.item.activity_id}});case 7:o=s.sent,0===o.code&&t.showToast({title:"加入成功",icon:"none"});case 9:s.next=12;break;case 11:"community"===r.sign&&(a=i.id,h=i.goods_id,r.$request({url:r.$api.community.cart_add,data:{activity_id:r.item.id,goods_id:h,goods_attr_id:a,num:e},method:"post"}).then((function(t){0===t.code&&r.addResult(t.data.queue_id,t.data.token)})));case 12:case"end":return s.stop()}}),n)})))()},addResult:function(i,e){var s=this;this.$request({url:this.$api.community.cart_result,method:"post",data:{queue_id:i,token:e}}).then((function(r){0===r.code?r.data&&1===r.data.retry?s.getResult=setTimeout((function(){s.addResult(i,e)}),1e3):(s.attrShow=0,t.hideLoading(),t.showToast({title:"添加成功",duration:1e3})):(t.hideLoading(),t.showToast({title:r.msg,icon:"none",duration:1e3}))}))},next:function(){var i=this;this.cur_index+1!==this.videoList.length?(this.distance=this.distance-this.sysheight,this.containerStyle="transform:translateY(".concat(this.distance,"px)"),clearTimeout(this.ne),this.ne=setTimeout((function(){i.videoList[i.cur_index].flag=!1,i.cur_index=i.cur_index+1,i.videoList[i.cur_index].flag=!0})),this.videoList.length<this.cur_index+2&&(this.page++,this.getVideo())):t.showToast({title:"无更多视频",icon:"none"})}},onShareAppMessage:function(){var t=this.goods_list[this.cur_index],i={id:t.id,mch_id:t.mch_id};return"integral_mall"===t.sign&&(delete i.id,i.goods_id=t.id),this.$shareAppMessage({title:t.app_share_title?t.app_share_title:t.name,imageUrl:t.app_share_pic?t.app_share_pic:t.cover_pic,path:t.page_url.split("?")[0],params:i})},watch:{appAttr:{handler:function(t){"none"===t.display&&(this.show_pt=!1)}}},onUnload:function(){this.videoCtx=null,clearTimeout(this.getResult)}};i.default=v}).call(this,e("543d")["default"])},2909:function(t,i,e){"use strict";var s;e.d(i,"b",(function(){return r})),e.d(i,"c",(function(){return n})),e.d(i,"a",(function(){return s}));var r=function(){var t=this,i=t.$createElement;t._self._c;t._isMounted||(t.e0=function(i){t.goodBool=!t.goodBool})},n=[]},9512:function(t,i,e){"use strict";e.r(i);var s=e("19c4"),r=e.n(s);for(var n in s)"default"!==n&&function(t){e.d(i,t,(function(){return s[t]}))}(n);i["default"]=r.a},"99d8":function(t,i,e){},a883:function(t,i,e){"use strict";var s=e("99d8"),r=e.n(s);r.a},af0a:function(t,i,e){"use strict";e.r(i);var s=e("2909"),r=e("9512");for(var n in r)"default"!==n&&function(t){e.d(i,t,(function(){return r[t]}))}(n);e("a883");var o,a=e("f0c5"),h=Object(a["a"])(r["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],o);i["default"]=h.exports}},[["105f","common/runtime","common/vendor"]]]);