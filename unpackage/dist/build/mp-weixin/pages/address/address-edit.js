(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/address/address-edit"],{"13b1":function(t,e,r){"use strict";r.r(e);var n=r("1c3d"),i=r("f7db");for(var a in i)"default"!==a&&function(t){r.d(e,t,(function(){return i[t]}))}(a);r("82bd");var o,s=r("f0c5"),c=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"47e5c4a4",null,!1,n["a"],o);e["default"]=c.exports},"1c3d":function(t,e,r){"use strict";var n;r.d(e,"b",(function(){return i})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){return n}));var i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.focus=!1},t.e1=function(e){t.focus=!1})},a=[]},"3ead":function(t,e,r){"use strict";(function(t){r("aaea");n(r("66fd"));var e=n(r("13b1"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,r("543d")["createPage"])},"82bd":function(t,e,r){"use strict";var n=r("a562"),i=r.n(n);i.a},a562:function(t,e,r){},e08e:function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(r("a34a")),i=r("2f62"),a=o(r("2ee0"));function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return l(t)||f(t,e)||u(t,e)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"===typeof t)return d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)if(r.push(o.value),e&&r.length===e)break}catch(c){i=!0,a=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(i)throw a}}return r}}function l(t){if(Array.isArray(t))return t}function m(t,e){if(null==t)return{};var r,n,i=h(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function h(t,e){if(null==t)return{};var r,n,i={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}function p(t,e,r,n,i,a,o){try{var s=t[a](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,i)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){p(a,n,i,o,s,"next",t)}function s(t){p(a,n,i,o,s,"throw",t)}o(void 0)}))}}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){y(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function y(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var g=function(){r.e("components/page-component/app-area-picker/app-area-picker").then(function(){return resolve(r("7243"))}.bind(null,r)).catch(r.oe)},w=function(){r.e("components/basic-component/app-textarea/app-textarea").then(function(){return resolve(r("f495"))}.bind(null,r)).catch(r.oe)},O={name:"address-edit",data:function(){return{form:{location:"",latitude:"",longitude:"",id:"",name:"",mobile:"",address:"",province_id:0,city_id:0,district_id:0,detail:"",type:""},is_refund_address:0,detail_url:"",list:[],submit_status:!1,tt_area_show:!1,automatic:"",provinceString:"",cityString:"",areaString:"",focus:!1}},computed:_({},(0,i.mapGetters)("mallConfig",{getTheme:"getTheme"})),components:{appAreaPicker:g,appTextArea:w},onLoad:function(e){var r=this;if(this.form.type=1==e.type?1:0,this.getAutoInfo(),e.is_refund_address>0?(this.is_refund_address=e.is_refund_address,this.detail_url=this.$api.app_admin.refund_address_edit,t.setNavigationBarTitle({title:"编辑退货地址"})):(this.is_refund_address=0,this.detail_url=this.$api.user.address_detail),e.form){var n=JSON.parse(e.form);"undefined"===typeof n.type&&(n.type=this.form.type),this.form=n}e.id>0?(this.$showLoading({title:"加载中"}),this.$request({url:this.detail_url,data:e}).then((function(n){if(r.$hideLoading(),0===n.code)if(e.is_refund_address>0){var i=n.data.detail;r.getInfo(Object.assign({detail:i.address_detail},i))}else r.form=n.data.list;else t.showToast({title:n.msg,icon:"none"});r.tt_area_show=!0})).catch((function(){r.$hideLoading(),r.tt_area_show=!0}))):this.tt_area_show=!0},methods:{getAutoInfo:function(){var t=this;return v(n.default.mark((function e(){var r,i,a,o,s;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$request({url:t.$api.user.auto_address_info,method:"get"});case 2:r=e.sent,0===r.code&&(i=JSON.parse(r.data),a=i.reduce((function(t,e){e.children;var r=m(e,["children"]);return t.concat(r)}),[]),o=i.reduce((function(t,e){return t.concat(e.children.map((function(t){t.children;var r=m(t,["children"]);return _(_({},r),{},{provinceCode:e.code})})))}),[]),s=i.reduce((function(t,e){var r=e.code;return t.concat(e.children.reduce((function(t,e){var n=e.code;return t.concat(e.children.map((function(t){t.children;var e=m(t,["children"]);return _(_({},e),{},{cityCode:n,provinceCode:r})})))}),[]))}),[]),t.provinceString=JSON.stringify(a),t.cityString=JSON.stringify(o),t.areaString=JSON.stringify(s));case 4:case"end":return e.stop()}}),e)})))()},getChooseLocation:function(){var e=this;return v(n.default.mark((function r(){var i,a,o,c,u,d;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=e,r.next=3,t.chooseLocation();case 3:a=r.sent,o=s(a,2),c=o[0],u=o[1],u&&(i.form.location=u.address+u.name,i.form.latitude=u.latitude,i.form.longitude=u.longitude),c&&(d=function(){t.showModal({title:"授权权限",content:"请先授权地理位置权限",success:function(e){e.confirm&&t.openSetting({success:function(e){e.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){i.form.location=t.address+t.name,i.form.latitude=t.latitude,i.form.longitude=t.longitude}}):t.showToast({title:"授权失败",icon:"none"})}})}})},"chooseLocation:fail auth deny"===c.errMsg&&d());case 9:case"end":return r.stop()}}),r)})))()},getInfo:function(e){var r=this;this.$request({url:this.$api.user.wechat_district,data:{province_name:e.address[0],city_name:e.address[1],county_name:e.address[2]}}).then((function(t){if(0===t.code){var n=t.data.district,i=n.province,a=n.city,o=n.district;e.province_id=i.id,e.city_id=a.id,e.district_id=o.id,r.form=e}})).catch((function(){t.showToast({title:"网络异常",icon:"none"})}))},areaEvent:function(t){t&&(this.form.province_id=t.province.id,this.form.city_id=t.city.id,this.form.district_id=t.district.id,this.list=[t.province.name,t.city.name,t.district.name])},submit:function(){var e=this;return v(n.default.mark((function r(){var i,a,o,s,c,u,d,f,l;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,!e.submit_status){r.next=3;break}return r.abrupt("return");case 3:if(e.form.detail||(i=1==e.form.type?"门牌号不能为空":"详细地址不能为空"),e.form.province_id||0!=e.form.type||(i="地区不能为空"),e.form.mobile||(i="联系方式不能为空"),e.$validation.landline(e.form.mobile)||e.$validation.mobile(e.form.mobile)||(i="联系方式格式错误"),e.form.name||(i="姓名不能为空"),!i){r.next=11;break}return t.showToast({title:i,icon:"none"}),r.abrupt("return");case 11:return e.submit_status=!0,e.is_refund_address>0?(s=e.form,c=s.id,u=s.name,d=s.mobile,f=s.detail,o=e.$api.app_admin.refund_address_edit,a={form:JSON.stringify({id:c,name:u,mobile:d,address_detail:f,address:e.list,is_default:0,remark:""})}):(o=e.$api.user.address_save,a=Object.assign({},e.form)),r.next=15,e.$request({url:o,data:a,method:"POST"});case 15:l=r.sent,e.submit_status=!1,0===l.code?(t.showToast({title:l.msg,icon:"none"}),t.navigateBack({delta:1})):t.showToast({title:l.msg,icon:"none"}),r.next=24;break;case 20:throw r.prev=20,r.t0=r["catch"](0),e.submit_status=!1,new Error(r.t0);case 24:case"end":return r.stop()}}),r,null,[[0,20]])})))()},getAddress:function(){var e=(0,a.default)(this.automatic,{},this.provinceString,this.cityString,this.areaString);if(!this.$validation.empty(e)){for(var r=t.getStorageSync("_DISTRICT"),n=e.name,i=e.province,o=e.city,s=e.area,c=e.phone,u=e.detail,d=0;d<r.length;d++)if(r[d].name===i){for(var f=0;f<r[d].list.length;f++){if(r[d].list[f].name===o){for(var l=0;l<r[d].list[f].list.length;l++)if(r[d].list[f].list[l].name===s){this.form.province_id=r[d].id,this.form.city_id=r[d].list[f].id,this.form.district_id=r[d].list[f].list[l].id;break}break}if("市辖区"===o){for(var m=0;m<r[d].list[f].list.length;m++)if(r[d].list[f].list[m].name===s){this.form.province_id=r[d].id,this.form.city_id=r[d].list[f].id,this.form.district_id=r[d].list[f].list[m].id;break}break}}break}this.form.name=n,this.form.detail="".concat(u),this.form.mobile=c}},detailFocus:function(){this.focus=!0}}};e.default=O}).call(this,r("543d")["default"])},f7db:function(t,e,r){"use strict";r.r(e);var n=r("e08e"),i=r.n(n);for(var a in n)"default"!==a&&function(t){r.d(e,t,(function(){return n[t]}))}(a);e["default"]=i.a}},[["3ead","common/runtime","common/vendor"]]]);