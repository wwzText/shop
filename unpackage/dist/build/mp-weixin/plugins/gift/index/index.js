(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["plugins/gift/index/index"],{1422:function(t,e,i){"use strict";var n;i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return n}));var o=function(){var t=this,e=t.$createElement,i=(t._self._c,Number(96)),n=Object.keys(t.gift);t._isMounted||(t.e0=function(e){t.voice_i=0}),t.$mp.data=Object.assign({},{$root:{m0:i,g0:n}})},r=[]},"1cec":function(t,e,i){"use strict";i.r(e);var n=i("1422"),o=i("8440");for(var r in o)"default"!==r&&function(t){i.d(e,t,(function(){return o[t]}))}(r);i("1f55");var s,a=i("f0c5"),u=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=u.exports},"1f55":function(t,e,i){"use strict";var n=i("62a8"),o=i.n(n);o.a},"62a8":function(t,e,i){},74444:function(t,e,i){"use strict";(function(t){i("b8bc");n(i("66fd"));var e=n(i("1cec"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},8440:function(t,e,i){"use strict";i.r(e);var n=i("c2d8"),o=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);e["default"]=o.a},c2d8:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(i("a34a")),o=i("2f62");function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function c(t,e,i,n,o,r,s){try{var a=t[r](s),u=a.value}catch(c){return void i(c)}a.done?e(u):Promise.resolve(u).then(n,o)}function l(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var r=t.apply(e,i);function s(t){c(r,n,o,s,a,"next",t)}function a(t){c(r,n,o,s,a,"throw",t)}s(void 0)}))}}var f=function(){i.e("plugins/gift/components/index/pick-gift").then(function(){return resolve(i("8366"))}.bind(null,i)).catch(i.oe)},d=function(){i.e("plugins/gift/components/index/gift-method").then(function(){return resolve(i("2e06"))}.bind(null,i)).catch(i.oe)},h=function(){i.e("plugins/gift/components/index/blessing-message").then(function(){return resolve(i("89f0"))}.bind(null,i)).catch(i.oe)},p=function(){Promise.all([i.e("common/vendor"),i.e("plugins/gift/components/index/generate-package")]).then(function(){return resolve(i("272f"))}.bind(null,i)).catch(i.oe)},g=function(){i.e("plugins/gift/components/announcement/gift-navigation").then(function(){return resolve(i("f293"))}.bind(null,i)).catch(i.oe)},_=function(){i.e("components/basic-component/app-empty-bottom/app-empty-bottom").then(function(){return resolve(i("c2f3"))}.bind(null,i)).catch(i.oe)},m=function(){i.e("plugins/gift/components/index/get-right-now").then(function(){return resolve(i("e692"))}.bind(null,i)).catch(i.oe)},v=function(){i.e("plugins/gift/components/index/voice").then(function(){return resolve(i("4d52"))}.bind(null,i)).catch(i.oe)},b={name:"index",data:function(){return{gift_list:[],totalPrice:0,method_type:"direct_open",open_type:0,open_num:null,select_str:"",open_time:"",bless_word:"",config:{},is_gift:!1,gift_id:-1,turn_no:"",gift:{},currentRoute:this.$platDiff.route(),navBool:!1,new_open_type:"",src:"",innerAudioContext:"",is_play:!1,audio:{},recorderManager:null,music_play:!1,bless_music:"",voice_i:0,voice_time:-1}},onLoad:function(e){var i=this;if(this.$user.isLogin()){if(e.gift_id&&e.user_id)this.is_gift=!0,this.gift_id=e.gift_id,this.turn_no=e.turn_no,this.getGift(this.gift_id);else if(e.pay_data){var n=JSON.parse(e.pay_data).gift_id;this.$request({url:this.$api.gift.cancel,data:{gift_id:n}})}}else this.$user.getInfo().then((function(){e.gift_id&&e.user_id&&(i.gift_id=e.gift_id,i.is_gift=!0,i.turn_no=e.turn_no,i.getGift(i.gift_id))}));this.request();var o=this;this.recorderManager=t.getRecorderManager({duration:3e4}),this.innerAudioContext=t.createInnerAudioContext(),this.innerAudioContext.onEnded((function(t){o.is_play=!1,o.music_play=!1})),this.innerAudioContext.onStop((function(){})),this.innerAudioContext.autoplay=!0,this.recorderManager.onStop((function(e){t.uploadFile({url:o.$api.upload.file,filePath:e.tempFilePath,name:"file",fileType:"audio",formData:{file:e.tempFilePath,file_name:""},success:function(t){var e=JSON.parse(t.data),i=(e.code,e.data);o.bless_music=i.url}}),o.audio=e})),wx.showShareMenu({menus:["shareAppMessage","shareTimeline"]})},onShow:function(){this.gift_list=this.$storage.getStorageSync("GIFT_CART");for(var t=0;t<this.gift_list.length;t++)this.gift_list[t].total_cost=parseFloat((this.gift_list[t].number*this.gift_list[t].price).toFixed(2))},onUnload:function(){this.innerAudioContext&&(this.music_play=!1,this.is_play=!1,this.innerAudioContext.stop())},onHide:function(){this.innerAudioContext&&(this.music_play=!1,this.is_play=!1,this.innerAudioContext.stop())},onShareAppMessage:function(){return this.$shareAppMessage({path:"/plugins/gift/index/index",title:this.config.ask_gift})},onShareTimeline:function(){return this.$shareTimeline({title:this.config.ask_gift,query:{}})},methods:{request:function(){var e=this;return l(n.default.mark((function i(){var o;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.$utils.showLoading(),i.prev=1,i.next=4,e.$request({url:e.$api.gift.config,method:"get"});case 4:o=i.sent,e.$utils.hideLoading(),0===o.code?(e.config=o.data,t.setNavigationBarTitle({title:o.data.title}),e.$store.commit("gift/setTheme",Number(o.data.theme.id)),e.$store.commit("gift/setGiftPic",o.data.big_gift_pic),e.method_type=e.config.type[0]):t.showModal({title:"提示",content:o.msg}),i.next=13;break;case 9:throw i.prev=9,i.t0=i["catch"](1),e.$utils.hideLoading(),new Error(i.t0);case 13:case"end":return i.stop()}}),i,null,[[1,9]])})))()},giftNumber:function(t,e){this.gift_list[t].number+=e,this.changeNumber(t)},giftInput:function(t,e){if(e>=this.gift_list[t].attr.stock){var i=JSON.parse(JSON.stringify(this.gift_list[t]));i.number=this.gift_list[t].attr.stock,this.$set(this.gift_list,t,i),this.changeNumber(t)}else this.$set(this.gift_list[t],"number",e),this.changeNumber(t)},changeNumber:function(t){var e=this.gift_list[t],i=e.number,n=e.price;this.$set(this.gift_list[t],"total_cost",parseFloat((i*n).toFixed(2))),0===this.gift_list[t].number&&this.$delete(this.gift_list,t),this.$storage.setStorageSync("GIFT_CART",this.gift_list)},submit:function(){var e=this;return l(n.default.mark((function i(){var o,r,s,a,u;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:for(e.$utils.showLoading(),o=[{mch_id:0,type:e.method_type,open_num:e.open_num,open_time:e.open_time,bless_word:e.bless_word?e.bless_word:e.config.bless_word,bless_music:e.bless_music,open_type:e.open_type,goods_list:[],remark:"",use_integral:0,user_coupon_id:0}],r=0;r<e.gift_list.length;r++){for(s={id:e.gift_list[r].attr.goods_id,attr:[],num:e.gift_list[r].number,cat_id:0,goods_attr_id:e.gift_list[r].attr.id},a=0;a<e.gift_list[r].attr.attr_list.length;a++)s.attr.push({attr_id:e.gift_list[r].attr.attr_list[a].attr_id,attr_group_id:e.gift_list[r].attr.attr_list[a].attr_group_id});o[0].goods_list.push(s)}u={form_data:JSON.stringify({list:o})},e.$store.commit("gift/setFormData",u),"direct_open"===e.method_type?(delete o[0].open_num,delete o[0].open_time):"time_open"===e.method_type?delete o[0].open_num:"num_open"===e.method_type&&delete o[0].open_time,e.$utils.hideLoading(),t.navigateTo({url:"/pages/order-submit/order-submit?preview_url=".concat(encodeURIComponent(e.$api.gift.order_preview),"&submit_url=").concat(encodeURIComponent(e.$api.gift.order_submit),"&pay_data_url=").concat(encodeURIComponent(e.$api.gift.pay_data),"&show_pay_result=false&mch_list=").concat(JSON.stringify(o),"&theme=").concat(e.theme,"&order_page_url=/plugins/gift/share/share&pay_cancel_url=/plugins/gift/index/index")});case 8:case"end":return i.stop()}}),i)})))()},generatePackage:function(){this.submit()},set_methods:function(t){this.method_type=t},set_people_status:function(t){this.open_type=t},change_people:function(t){this.open_num=t},set_lottery_time:function(t,e){this.select_str=t,this.open_time=e},changeTextarea:function(t){this.bless_word=t},pay_data:function(e){var i=this;return l(n.default.mark((function o(){var r;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,i.$request({url:i.$api.gift.pay_data,method:"post",data:a({},e)});case 3:r=n.sent,0===r.code?r.data.hasOwnProperty("id")?(i.$payment.pay(r.data.id).then((function(){i.$storage.setStorageSync("GIFT_CART",[]),t.redirectTo({url:"/plugins/gift/share/share?gift_id=".concat(r.data.gift_id)})})).catch((function(){})),i.$utils.hideLoading()):setTimeout((function(){i.pay_data(e)}),1e3):(i.$utils.hideLoading(),t.showModal({title:"提示",content:r.msg})),n.next=11;break;case 7:throw n.prev=7,n.t0=n["catch"](0),i.$utils.hideLoading(),new Error(n.t0);case 11:case"end":return n.stop()}}),o,null,[[0,7]])})))()},setGift:function(t){this.is_gift=t},getGift:function(e){var i=this;return l(n.default.mark((function o(){var r;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i.$utils.showLoading(),n.next=3,i.$request({url:i.$api.gift.gift,data:{gift_id:e}});case 3:r=n.sent,0===r.code?(i.gift=r.data,i.wordYun(i.gift.list.bless_word)):t.showModal({title:"提示",content:r.msg}),i.$utils.hideLoading();case 6:case"end":return n.stop()}}),o)})))()},setNav:function(){for(var t=this.currentRoute,e=0;e<this.tabBarNavs.length;e++)if(t.includes(this.tabBarNavs[e].url.split("?")[0]))return this.navBool=!0;return this.navBool=!1},play:function(t){this.is_play=t,t?(this.innerAudioContext.src=this.audio.tempFilePath,this.innerAudioContext.play()):this.innerAudioContext.stop()},recorder:function(t){var e=this;t?(clearInterval(this.voice_time),this.voice_i=0,this.voice_time=setInterval((function(){e.voice_i++}),1e3),this.recorderManager.start()):(this.recorderManager.stop(),clearInterval(this.voice_time))},music:function(t,e){this.music_play=t,t?(this.innerAudioContext.src=e,this.innerAudioContext.play()):this.innerAudioContext.stop()},close:function(){this.is_play=!1,this.innerAudioContext.stop()}},watch:{gift_list:{handler:function(t){this.totalPrice=0;for(var e=0;e<t.length;e++)this.totalPrice+=t[e].total_cost;this.totalPrice=this.totalPrice.toFixed(2)},immediate:!0,deep:!0},tabBarNavs:{handler:function(){this.setNav()},immediate:!0}},computed:a(a(a({},(0,o.mapState)("gift",{theme:function(t){return t.theme},big_gift_pic:function(t){return t.big_gift_pic}})),(0,o.mapState)({tabBarNavs:function(t){return t.mallConfig.navbar.navs}})),(0,o.mapGetters)("iPhoneX",{BotHeight:"getNavHei"})),components:{"pick-gift":f,"gift-method":d,"blessing-message":h,"generate-package":p,"gift-navigation":g,"app-empty-bottom":_,"get-right-now":m,voice:v}};e.default=b}).call(this,i("543d")["default"])}},[["74444","common/runtime","common/vendor"]]]);