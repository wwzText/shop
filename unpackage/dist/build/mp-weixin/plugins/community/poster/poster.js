(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["plugins/community/poster/poster"],{"0871":function(t,e,i){"use strict";i.r(e);var o=i("c915e"),a=i.n(o);for(var c in o)"default"!==c&&function(t){i.d(e,t,(function(){return o[t]}))}(c);e["default"]=a.a},"1bed":function(t,e,i){},"3b36":function(t,e,i){"use strict";var o;i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return c})),i.d(e,"a",(function(){return o}));var a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.__map(t.styleList,(function(e,i){var o=t.__get_orig(e),a=t.config.activity_poster_style.indexOf(e.value.toString());return{$orig:o,g0:a}})));t.$mp.data=Object.assign({},{$root:{l0:i}})},c=[]},8590:function(t,e,i){"use strict";var o=i("1bed"),a=i.n(o);a.a},c915e:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("2f62");function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var l={name:"goods",data:function(){return{styleList:[{label:"样式一",value:1},{label:"样式二",value:2},{label:"样式三",value:3},{label:"样式四",value:4}],typeList:[],selectForm:null,config:{color:[],activity_poster_style:[]},address:"",info:{},activity:{},middleman:{},rpx:1,canvas:null,canvas2:null,ctx:null,activity_id:0,middleman_id:0}},computed:c(c({},(0,o.mapGetters)("mallConfig",{getTheme:"getTheme"})),(0,o.mapState)({community:function(t){return t.mallConfig.__wxapp_img.community}})),onLoad:function(e){var i=this;i.activity_id=e.activity_id,i.middleman_id=e.middleman_id,t.getSystemInfo({success:function(t){i.rpx=t.windowWidth/375}}),i.loadData()},methods:{drawText:function(t,e,i,o,a,c,s,l){0!=i.indexOf("我在")&&i.indexOf("提货地址");var n=i.split(""),r="",d=[];1==t&&(o*=2),e.font=o+"px sans-serif",e.fillStyle="#353535",e.textBaseline="middle";for(var f=0;f<n.length;f++)e.measureText(r).width<s||(d.push(r),r=""),r+=n[f];if(d.push(r),d.length>2)for(var v=0;v<2;v++){l&&(e.textAlign="center");var g=d[v];void 0==g&&(g=""),1==v&&(g=g.substring(0,g.length-1)+"..."),"..."!==g&&e.fillText(g,a,c+(v+1)*o*1.2)}else for(v=0;v<d.length;v++)l&&(e.textAlign="center"),e.fillText(d[v],a,c+(v+1)*o*1.2)},fillRoundRect:function(t,e,i,o,a,c,s){if(2*c>o||2*c>a)return!1;t.save(),t.translate(e,i),this.drawRoundRectPath(t,o,a,c),t.fillStyle=s||"#000",t.fill(),t.restore()},strokeRoundRect:function(t,e,i,o,a,c,s,l){if(2*c>o||2*c>a)return!1;t.save(),t.translate(e,i),this.drawRoundRectPath(t,o,a,c),t.lineWidth=s||2,t.strokeStyle=l||"#000",t.stroke(),t.restore()},drawRoundRectPath:function(t,e,i,o){t.beginPath(0),t.arc(e-o,i-o,o,0,Math.PI/2),t.lineTo(o,i),t.arc(o,i-o,o,Math.PI/2,Math.PI),t.lineTo(0,o),t.arc(o,o,o,Math.PI,3*Math.PI/2),t.lineTo(e-o,0),t.arc(e-o,o,o,3*Math.PI/2,2*Math.PI),t.lineTo(e,i-o),t.closePath()},loadData:function(){var e=this;e.$request({url:e.$api.community.poster,data:{activity_id:e.activity_id,middleman_id:e.middleman_id}}).then((function(i){e.$hideLoading(),0===i.code?(e.config=i.data.config,e.info=i.data.info,e.middleman=i.data.middleman,e.activity=i.data.activity,e.activity.goods_list=e.activity.goods_list.slice(0,6),e.typeList=[{label:"纯色",value:1},{label:"背景图",value:2}],e.selectForm={color:e.config["color"][0],style:e.config["activity_poster_style"][0],type:2},setTimeout((function(){var i=t.createSelectorQuery();i.select("#poster").fields({node:!0,size:!0}).exec((function(i){e.canvas=i[0].node,e.ctx=e.canvas.getContext("2d");var o=t.getSystemInfoSync().pixelRatio;e.canvas.width=i[0].width*o,e.canvas.height=i[0].height*o,e.ctx.scale(o,o),e.created(e.canvas,e.ctx,.4)}))}))):t.showToast({title:i.msg,icon:"none"})}))},changeStyle:function(t){var e=this;e.selectForm.style=t,setTimeout((function(){e.created(e.canvas,e.ctx,.4)}))},changeType:function(t){var e=this;e.selectForm.type=t,setTimeout((function(){e.created(e.canvas,e.ctx,.4)}))},changeColor:function(t){var e=this;e.selectForm.color=t,setTimeout((function(){e.created(e.canvas,e.ctx,.4)}))},submitSave:function(){var e=this;e.$showLoading({title:"正在保存图片"}),t.canvasToTempFilePath({canvas:e.canvas,success:function(i){t.getImageInfo({src:i.tempFilePath,success:function(i){t.saveImageToPhotosAlbum({filePath:i.path,success:function(){t.showToast({title:"保存成功"})},fail:function(e){e.errMsg&&t.showModal({title:"提示",content:"您好,请先授权保存到相册权限",showCancel:!1,success:function(e){e.confirm&&t.openSetting({success:function(e){e.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.showToast({title:"保存成功"})}}):t.showModal({title:"提示",content:"授权失败，请稍后重新获取",showCancel:!1})}})}})},complete:function(t){e.$hideLoading()}})},fail:function(e){t.showModal({title:"图片下载失败",content:e.errMsg,showCancel:!1})},complete:function(t){e.$hideLoading()}})}})},created:function(t,e,i){var o=this;if(o.$showLoading({type:"global",text:"生成中..."}),e.clearRect(0,0,750*i,1334*i),o.address=o.middleman.city+o.middleman.district,o.middleman.city!=o.middleman.province&&(o.address=o.middleman.province+o.address),1==o.selectForm.type)e.fillStyle=o.selectForm.color,e.fillRect(0,0,750*i,1334*i),o.chooseStyle(t,e,i);else{var a=t.createImage();a.src=o.config.image_bg,0==a.src.indexOf("http://")&&a.src.replace("http://","https://"),a.onload=function(){e.drawImage(a,0,0,750*i,1334*i),o.chooseStyle(t,e,i)}}},chooseStyle:function(t,e,i){var o,a,c,s,l,n,r,d,f,v,g,u,y,h,m,p,_=this,x=t.createImage();1==_.selectForm.style?(o=78*i,a=133*i,c=97*i,s=13,l=195*i,n=130*i,r=480*i,d=370*i,f=132*i,v=1e3*i,g=33*i,u=64*i,y=1060*i,h=440*i,m=984*i,p=240*i,x.src=_.community.style1):2==_.selectForm.style?(o=80*i,a=810*i,c=97*i,s=13,l=197*i,n=807*i,r=480*i,d=180*i,f=430*i,v=985*i,g=33*i,u=360*i,y=1045*i,h=70*i,m=945*i,p=240*i,x.src=_.community.style2):3==_.selectForm.style?(o=80*i,a=164*i,c=97*i,s=13,l=200*i,n=161*i,r=480*i,d=310*i,f=430*i,v=1040*i,g=33*i,u=360*i,y=1100*i,h=70*i,m=1e3*i,p=240*i,x.src=_.community.style3):4==_.selectForm.style&&(o=56*i,a=124*i,c=97*i,s=13,l=192*i,n=121*i,r=480*i,d=464*i,f=430*i,v=1040*i,g=33*i,u=360*i,y=1100*i,h=70*i,m=1e3*i,p=240*i,x.src=_.community.style4),x.onload=function(){e.drawImage(x,0,0,750*i,1334*i),e.save(),e.beginPath(),e.arc(c/2+o,c/2+a,c/2,0,2*Math.PI,!1),e.strokeStyle="white",e.stroke(),e.clip();var T=t.createImage();T.src=_.info.avatar,T.onload=function(){e.drawImage(T,o,a,c,c),e.restore();var x="我在"+_.address+_.middleman.location+"发现了一个超划算的团购！";e.textAlign="left",_.drawText(i,e,x,s,l,n,r),_.drawGoods(t,e,d),_.drawInfo(t,e,f,v,g,u,y,_.address);var w=t.createImage();w.src=_.activity.qrcode,w.onload=function(){e.drawImage(w,h,m,p,p)}}}},drawInfo:function(t,e,i,o,a,c,s,l){var n=this,r=.26,d=t.createImage();d.src=n.middleman.avatar,d.onload=function(){e.save(),e.beginPath(),e.arc(a/2+i,a/2+o,a/2,0,2*Math.PI,!1),e.strokeStyle="white",e.stroke(),e.clip(),e.drawImage(d,i,o,a,a),e.restore(),e.textAlign="left",e.font="10px sans-serif",e.fillStyle="#353535",e.fillText("团长:",c,s-62*r),e.fillText("结束时间: "+n.activity.end_at,c,s),e.fillText(n.middleman.name,i+63*r,s-62*r),n.drawText(r,e,"提货地址: "+l+n.middleman.detail,11,c,s+10*r,500*r)}},drawGoods:function(t,e,i){var o,a,c,s=this,l=.4,n=0,r=t.createImage();if(1==s.activity.goods_list.length)r.src=s.activity.goods_list[0].cover_pic,0==r.src.indexOf("http://")&&r.src.replace("http://","https://"),r.onload=function(){e.drawImage(r,195*l,i,360*l,360*l),s.drawText(l,e,s.activity.goods_list[0].name,14,370*l,i+360*l,590*l,!0),e.textAlign="center",e.font="14px sans-serif",e.fillStyle="#ff4544",e.fillText("￥"+s.activity.goods_list[0].price,370*l,i+490*l),e.font="13px sans-serif",e.fillStyle="#999999",e.fillText("￥"+s.activity.goods_list[0].original_price,370*l,i+520*l),a=15*(s.activity.goods_list[0].original_price.length+1)+30,o=375-a/2,e.fillRect(o*l,i+516*l,a*l,1),s.$hideLoading()};else if(2==s.activity.goods_list.length){i+=15*l;for(var d=0;d<s.activity.goods_list.length;d++)s.activity.goods_list[d].cover=t.createImage(),s.activity.goods_list[d].cover.src=s.activity.goods_list[d].cover_pic,0==s.activity.goods_list[d].cover.src.indexOf("http://")&&s.activity.goods_list[d].cover.src.replace("http://","https://"),s.activity.goods_list[d].cover.onload=function(){c=1==n?395*l:65*l,s.strokeRoundRect(e,c,i,290*l,450*l,8*l,2*l,"#e5e5e5"),e.beginPath(),e.save();var t=266*l,r=8*l,d=10*l,f=i+2*l,v=c+2*l;e.lineWidth=1,e.strokeStyle="white",e.moveTo(v+d,f),e.lineTo(v+d+t,f),e.arcTo(v+2*d+t,f,v+2*d+t,f+d,r),e.lineTo(v+2*d+t,f+2*d+t),e.lineTo(v,f+t+2*d),e.lineTo(v,f+d),e.arcTo(v,f,v+d,f,r),e.closePath(),e.stroke(),e.clip(),e.drawImage(s.activity.goods_list[n].cover,c+2*l,i+2*l,286*l,286*l),e.restore(),s.drawText(l,e,s.activity.goods_list[n].name,12,c+145*l,i+280*l,256*l,!0),e.textAlign="center",e.font="13px sans-serif",e.fillStyle="#ff4544",e.fillText("￥"+s.activity.goods_list[n].price,c+145*l,i+388*l),e.font="11px sans-serif",e.fillStyle="#999999",e.fillText("￥"+s.activity.goods_list[n].original_price,c+145*l,i+418*l),a=14*(s.activity.goods_list[n].original_price.length+1)+20,e.textAlign="center",o=c+(145-a/2)*l,e.fillRect(o,i+414*l,a*l,2*l),n++,2==n&&s.$hideLoading()}}else if(3==s.activity.goods_list.length)for(d=0;d<s.activity.goods_list.length;d++)s.activity.goods_list[d].cover=t.createImage(),s.activity.goods_list[d].cover.src=s.activity.goods_list[d].cover_pic,0==s.activity.goods_list[d].cover.src.indexOf("http://")&&s.activity.goods_list[d].cover.src.replace("http://","https://"),s.activity.goods_list[d].cover.onload=function(){n>0&&(i+=182*l),e.drawImage(s.activity.goods_list[n].cover,65*l,i,150*l,150*l),e.beginPath(),e.save();var t=130*l,c=8*l,r=10*l,d=65*l;e.lineWidth=1,e.strokeStyle="white",e.moveTo(d+r,i),e.arcTo(d+2*r+t,i,d+2*r+t,i+r,c),e.arcTo(d+2*r+t,i+2*r+t,d+r+t,i+2*r+t,c),e.arcTo(d,i+t+2*r,d,i+t+r,c),e.arcTo(d,i,d+2*r,i,c),e.closePath(),e.stroke(),e.clip(),e.restore(),e.textAlign="left",s.drawText(l,e,s.activity.goods_list[n].name,13,239*l,i-15*l,450*l),e.font="13px sans-serif",e.fillStyle="#ff4544",e.fillText("￥"+s.activity.goods_list[n].price,239*l,i+100*l),e.font="11px sans-serif",e.fillStyle="#999999",e.fillText("￥"+s.activity.goods_list[n].original_price,239*l,i+137*l),a=15*(s.activity.goods_list[n].original_price.length+1)+12,o=239,e.fillRect(o*l,i+135*l,a*l,2*l),n++,3==n&&s.$hideLoading()};else if(4==s.activity.goods_list.length){i-=10*l;for(d=0;d<s.activity.goods_list.length;d++)s.activity.goods_list[d].cover=t.createImage(),s.activity.goods_list[d].cover.src=s.activity.goods_list[d].cover_pic,0==s.activity.goods_list[d].cover.src.indexOf("http://")&&s.activity.goods_list[d].cover.src.replace("http://","https://"),s.activity.goods_list[d].cover.onload=function(){n>0&&(i+=140*l),e.beginPath(),e.save();var t=100*l,c=8*l,r=10*l,d=65*l;e.lineWidth=1,e.strokeStyle="white",e.moveTo(d+r,i),e.arcTo(d+2*r+t,i,d+2*r+t,i+r,c),e.arcTo(d+2*r+t,i+2*r+t,d+r+t,i+2*r+t,c),e.arcTo(d,i+t+2*r,d,i+t+r,c),e.arcTo(d,i,d+2*r,i,c),e.closePath(),e.stroke(),e.clip(),e.drawImage(s.activity.goods_list[n].cover,65*l,i,120*l,120*l),e.restore(),e.textAlign="left",s.drawText(l,e,s.activity.goods_list[n].name,12,209*l,i-25*l,480*l),e.font="12px sans-serif",e.fillStyle="#ff4544",e.fillText("￥"+s.activity.goods_list[n].price,209*l,i+80*l),e.font="10px sans-serif",e.fillStyle="#999999",e.fillText("￥"+s.activity.goods_list[n].original_price,209*l,i+102*l),a=12*(s.activity.goods_list[n].original_price.length+1)+12,o=212,e.fillRect(o*l,i+100*l,a*l,2*l),n++,4==n&&s.$hideLoading()}}else if(s.activity.goods_list.length>4)for(d=0;d<s.activity.goods_list.length;d++)s.activity.goods_list[d].cover=t.createImage(),s.activity.goods_list[d].cover.src=s.activity.goods_list[d].cover_pic,0==s.activity.goods_list[d].cover.src.indexOf("http://")&&s.activity.goods_list[d].cover.src.replace("http://","https://"),s.activity.goods_list[d].cover.onload=function(){c=48*l,o=192,1!=n&&3!=n&&5!=n||(c=398*l,o=537),0==n?i+=20*l:(2==n||4==n)&&(i+=172*l),e.beginPath(),e.save();var t=100*l,r=8*l,d=10*l;e.lineWidth=1,e.strokeStyle="white",e.moveTo(c+d,i),e.arcTo(c+2*d+t,i,c+2*d+t,i+d,r),e.arcTo(c+2*d+t,i+2*d+t,c+d+t,i+2*d+t,r),e.arcTo(c,i+t+2*d,c,i+t+d,r),e.arcTo(c,i,c+2*d,i,r),e.closePath(),e.stroke(),e.clip(),e.drawImage(s.activity.goods_list[n].cover,c,i,120*l,120*l),e.restore(),e.textAlign="left",s.drawText(l,e,s.activity.goods_list[n].name,12,c+134*l,i-25*l,166*l),e.font="12px sans-serif",e.fillStyle="#ff4544",e.fillText("￥"+s.activity.goods_list[n].price,c+134*l,i+80*l),e.font="10px sans-serif",e.fillStyle="#999999",e.fillText("￥"+s.activity.goods_list[n].original_price,c+134*l,i+102*l),a=12*(s.activity.goods_list[n].original_price.length+1)+12,e.fillRect(o*l,i+100*l,a*l,2*l),n++,5==n&&s.$hideLoading()}}}};e.default=l}).call(this,i("543d")["default"])},eb4b:function(t,e,i){"use strict";i.r(e);var o=i("3b36"),a=i("0871");for(var c in a)"default"!==c&&function(t){i.d(e,t,(function(){return a[t]}))}(c);i("8590");var s,l=i("f0c5"),n=Object(l["a"])(a["default"],o["b"],o["c"],!1,null,"59a2c0d5",null,!1,o["a"],s);e["default"]=n.exports},f83a:function(t,e,i){"use strict";(function(t){i("b8bc");o(i("66fd"));var e=o(i("eb4b"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])}},[["f83a","common/runtime","common/vendor"]]]);