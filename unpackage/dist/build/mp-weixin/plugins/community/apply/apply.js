(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["plugins/community/apply/apply"],{2660:function(t,e,n){"use strict";n.r(e);var i=n("4786"),r=n("65ed");for(var o in r)"default"!==o&&function(t){n.d(e,t,(function(){return r[t]}))}(o);n("b34e");var a,c=n("f0c5"),s=Object(c["a"])(r["default"],i["b"],i["c"],!1,null,"c04e75c8",null,!1,i["a"],a);e["default"]=s.exports},4786:function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var r=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.focus=!1})},o=[]},"5b3f":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,r=a(n("a34a")),o=n("2f62");function a(t){return t&&t.__esModule?t:{default:t}}function c(t,e){return f(t)||l(t,e)||d(t,e)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(t,e){if(t){if("string"===typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(i=(a=c.next()).done);i=!0)if(n.push(a.value),e&&n.length===e)break}catch(s){r=!0,o=s}finally{try{i||null==c["return"]||c["return"]()}finally{if(r)throw o}}return n}}function f(t){if(Array.isArray(t))return t}function m(t,e,n,i,r,o,a){try{var c=t[o](a),s=c.value}catch(d){return void n(d)}c.done?e(s):Promise.resolve(s).then(i,r)}function p(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){m(o,i,r,a,c,"next",t)}function c(t){m(o,i,r,a,c,"throw",t)}a(void 0)}))}}function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var g=function(){n.e("components/page-component/app-area-picker/app-area-picker").then(function(){return resolve(n("ffd4"))}.bind(null,n)).catch(n.oe)},b=function(){n.e("plugins/community/components/app-head").then(function(){return resolve(n("9780"))}.bind(null,n)).catch(n.oe)},_=function(){n.e("components/basic-component/app-textarea/app-textarea").then(function(){return resolve(n("1c74"))}.bind(null,n)).catch(n.oe)},w={data:function(){return{wait:!1,middleman:{status:99},id:null,form:{location:"",latitude:"",longitude:"",name:"",mobile:"",province_id:0,city_id:0,district_id:0,detail:""},location:"",setting:{middleman:""},is_refund_address:0,detail_url:"",list:[],submit_status:!1,automatic:"",province:[],focus:!1,address:!1}},computed:v(v({},(0,o.mapGetters)("mallConfig",{getTheme:"getTheme"})),(0,o.mapState)({community:function(t){return t.mallConfig.__wxapp_img.community},bonusImg:function(t){return t.mallConfig.__wxapp_img.bonus}})),components:{appAreaPicker:g,appTextArea:_,appHead:b},onLoad:function(t){t.id>0&&(this.address=!0),this.getPlace(),this.getStatus()},methods:(i={areaEvent:function(t){t&&(this.form.province_id=t.province.id,this.form.city_id=t.city.id,this.form.district_id=t.district.id)},toCommunity:function(){t.navigateTo({url:"/plugins/community/index/index"})},toIndex:function(){t.navigateTo({url:"/pages/index/index"})},reApply:function(){var t=this;t.middleman.status=-2},middlemanPay:function(){var e=this;if(e.id>0)return e.pay(e.id),!1;e.$request({url:e.$api.community.apply_pay,data:{id:e.middleman.id}}).then((function(n){0==n.code?e.pay(n.data.id):t.showToast({title:n.msg,icon:"none",duration:1e3})})).catch((function(t){e.$hideLoading()}))},getStatus:function(){var e=this;e.$request({url:e.$api.community.index}).then((function(n){e.$hideLoading(),0==n.code?(e.setting=n.data.setting,t.setNavigationBarTitle({title:"申请"+e.setting.middleman}),n.data.middleman.id>0?(e.middleman=n.data.middleman,e.address&&(e.middleman.status=-2,e.form=n.data.middleman,e.form.province==e.form.city?e.location=e.form.province+" "+e.form.district+" "+e.form.location:e.location=e.form.province+" "+e.form.city+" "+e.form.district+" "+e.form.location,t.setNavigationBarTitle({title:"填写"+e.setting.middleman+"信息"}))):e.middleman.status=-2):t.showToast({title:n.msg,icon:"none",duration:1e3})})).catch((function(){e.$hideLoading()}))},getPlace:function(){var e=this;e.$request({url:e.$api.city.cityName}).then((function(n){0===n.code?e.province=n.data.list:t.showToast({title:n.msg,icon:"none",duration:1e3})}))},getChooseLocation:function(){var e=this;return p(r.default.mark((function n(){var i,o,a,s,d,u,l,f,m,p,h,v,y;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e,!i.address){n.next=3;break}return n.abrupt("return",!1);case 3:return n.next=5,t.chooseLocation();case 5:if(o=n.sent,a=c(o,2),s=a[0],d=a[1],d){for(p in u="",l="",f="",m=d.name,d.address||(d.address="其他其他其他"),d.address=d.address.replace("北京市北京市","北京市"),d.address=d.address.replace("天津市天津市","天津市"),d.address=d.address.replace("上海市上海市","上海市"),d.address=d.address.replace("重庆市重庆市","重庆市"),d.address=d.address.replace("香港特别行政区香港特别行政区","香港特别行政区"),d.address=d.address.replace("澳门特别行政区澳门特别行政区","澳门特别行政区"),i.province)if(0==d.address.indexOf(i.province[p].name))for(h in u="undefined"!=i.province[p].name?i.province[p].name:"",i.form.province_id=i.province[p].id,"北京市"!=u&&"天津市"!=u&&"上海市"!=u&&"重庆市"!=u&&"澳门特别行政区"!=u&&"香港特别行政区"!=u&&(d.address=d.address.replace(u,"")),i.province[p].list)if(0==d.address.indexOf(i.province[p].list[h].name)&&i.province[p].list[h].parent_id==i.province[p].id)for(v in l="undefined"!=i.province[p].list[h].name?i.province[p].list[h].name:"",i.form.city_id=i.province[p].list[h].id,d.address=d.address.replace(l,""),i.province[p].list[h].list)0==d.address.indexOf(i.province[p].list[h].list[v].name)&&i.province[p].list[h].list[v].parent_id==i.province[p].list[h].id&&i.province[p].list[h].list[v].provinceCode==i.province[p].code&&(f="undefined"!=i.province[p].list[h].list[v].name?i.province[p].list[h].list[v].name:"",i.form.district_id=i.province[p].list[h].list[v].id);u&&f&&m||(i.form.province_id="",i.form.city_id="",i.form.district_id=""),i.location=u==l?u+" "+f+" "+m:u+" "+l+" "+f+" "+m,i.form.location=m,i.form.latitude=d.latitude,i.form.longitude=d.longitude}s&&(y=function(){t.showModal({title:"授权权限",content:"请先授权地理位置权限",success:function(e){e.confirm&&t.openSetting({success:function(e){e.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){i.getChooseLocation()}}):t.showToast({title:"授权失败",icon:"none"})}})}})},"chooseLocation:fail auth deny"===s.errMsg&&y());case 11:case"end":return n.stop()}}),n)})))()},getInfo:function(e){var n=this;this.$request({url:this.$api.user.wechat_district,data:{province_name:e.address[0],city_name:e.address[1],county_name:e.address[2]}}).then((function(t){if(0===t.code){var i=t.data.district,r=i.province,o=i.city,a=i.district;e.province_id=r.id,e.city_id=o.id,e.district_id=a.id,n.form=e}})).catch((function(){t.showToast({title:"网络异常",icon:"none"})}))}},y(i,"areaEvent",(function(t){t&&(this.form.province_id=t.province.id,this.form.city_id=t.city.id,this.form.district_id=t.district.id,this.list=[t.province.name,t.city.name,t.district.name])})),y(i,"saveAddress",(function(){var e=this;return this.form.detail&&this.form.province_id&&this.form.city_id&&this.form.district_id?void e.$request({url:e.$api.community.edit_address,data:{detail:e.form.detail},method:"post"}).then((function(e){t.showToast({title:e.msg,icon:"none",duration:1e3}),0==e.code&&setTimeout((function(){t.navigateBack({})}),1e3)})).catch((function(t){e.$hideLoading()})):(t.showToast({title:"提货地址不能为空",icon:"none"}),!1)})),y(i,"submit",(function(){var e=this;return p(r.default.mark((function n(){var i,o,a,c,s,d,u,l,f,m,p;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!e.submit_status){n.next=3;break}return n.abrupt("return");case 3:if(e.form.detail||(i="提货地址不能为空"),e.form.location||(i="所在地区不能为空"),e.form.mobile||(i="手机号不能为空"),e.form.name||(i="姓名不能为空"),!i){n.next=10;break}return t.showToast({title:i,icon:"none"}),n.abrupt("return");case 10:return e.submit_status=!0,o=e.$api.community.apply,a=e.form,e.is_refund_address>0&&(o=e.$api.app_admin.refund_address_edit,c=e.form,s=c.id,d=c.name,u=c.mobile,l=c.detail,a={form:JSON.stringify({id:s,name:d,mobile:u,address_detail:l,address:e.list,is_default:0,remark:""})}),n.next=16,e.$request({url:o,data:a,method:"POST"});case 16:f=n.sent,e.submit_status=!1,0===f.code?(m=f.data.queue_id,p=f.data.token,e.getResult(m,p)):t.showToast({title:f.msg,icon:"none"}),n.next=25;break;case 21:throw n.prev=21,n.t0=n["catch"](0),e.submit_status=!1,new Error(n.t0);case 25:case"end":return n.stop()}}),n,null,[[0,21]])})))()})),y(i,"getResult",(function(e,n){var i=this;this.$request({url:this.$api.community.apply_result,data:{queue_id:e,token:n}}).then((function(r){0===r.code?r.data.retry&&1===r.data.retry?i.getPayDataTimer=setTimeout((function(){i.getResult(e,n)}),1e3):(t.hideLoading(),r.data.id>0&&(i.id=r.data.id),i.getStatus()):(i.exchangeCoupon=!1,t.hideLoading(),t.showModal({title:"提示",content:r.msg,showCancel:!1}))})).catch((function(e){i.exchangeCoupon=!1,t.hideLoading(),t.showModal({title:"提示",content:e.errMsg,showCancel:!1})}))})),y(i,"pay",(function(e){var n=this;this.$payment.pay(e).then((function(t){n.getStatus()})).catch((function(){t.showToast({title:"支付失败",icon:"none",duration:1e3})}))})),y(i,"detailFocus",(function(){this.focus=!0})),i)};e.default=w}).call(this,n("543d")["default"])},"65ed":function(t,e,n){"use strict";n.r(e);var i=n("5b3f"),r=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=r.a},b34e:function(t,e,n){"use strict";var i=n("f627"),r=n.n(i);r.a},d84b5:function(t,e,n){"use strict";(function(t){n("b8bc");i(n("66fd"));var e=i(n("2660"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},f627:function(t,e,n){}},[["d84b5","common/runtime","common/vendor"]]]);