{"version":3,"sources":["uni-app:///main.js","webpack:////Users/wanglong/Desktop/shop4.3.57/pages/poster/poster.vue?bf43","webpack:////Users/wanglong/Desktop/shop4.3.57/pages/poster/poster.vue?7cea","webpack:////Users/wanglong/Desktop/shop4.3.57/pages/poster/poster.vue?4b96","webpack:////Users/wanglong/Desktop/shop4.3.57/pages/poster/poster.vue?76e8","uni-app:///pages/poster/poster.vue","webpack:////Users/wanglong/Desktop/shop4.3.57/pages/poster/poster.vue?22db","webpack:////Users/wanglong/Desktop/shop4.3.57/pages/poster/poster.vue?b145"],"names":["createPage","Page"],"mappings":"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","file":"pages/poster/poster.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/poster/poster.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./poster.vue?vue&type=template&id=132a9d26&scoped=true&\"\nvar renderjs\nimport script from \"./poster.vue?vue&type=script&lang=js&\"\nexport * from \"./poster.vue?vue&type=script&lang=js&\"\nimport style0 from \"./poster.vue?vue&type=style&index=0&id=132a9d26&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"132a9d26\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/poster/poster.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./poster.vue?vue&type=template&id=132a9d26&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./poster.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./poster.vue?vue&type=script&lang=js&\"","<template>\n    <app-layout>\n        <view class=\"poster\">\n            <view id=\"head\" class=\"head\">\n                <view class=\"main-center cross-center\">\n                    <!-- #ifdef MP-WEIXIN -->\n                    <canvas type=\"2d\" id=\"poster\" style=\"width: 300px; height: 533.6px;\"></canvas>\n                    <!-- #endif -->\n                    <!-- #ifndef MP-WEIXIN -->\n                    <canvas id=\"poster\" :width=\"300*dpr\" :height=\"533.6*dpr\" style=\"width: 300px; height: 533.6px;\"></canvas>\n                    <!-- #endif -->\n                </view>\n            </view>\n            <view class=\"button main-center cross-center\" @click=\"submitSave\"\n                  :class=\"getTheme + '-m-back ' + getTheme\">保存图片\n            </view>\n        </view>\n    </app-layout>\n</template>\n\n<script>\n    import { mapState,mapGetters } from \"vuex\";\n\n    export default {\n        data() {\n            return {\n                card_id: 0,\n                coupon_id: 0,\n                rpx: 1,\n                show: false,\n                info: {},\n                canvas: null,\n                dpr: 2,\n            }\n        },\n        computed: {\n            ...mapGetters('mallConfig', {\n                getTheme: 'getTheme',\n            }),\n            ...mapState({\n                poster_img: state => state.mallConfig.__wxapp_img.poster,\n            })\n        },\n        methods: {\n            imgLoad(img) {\n                return new Promise((resolve, reject) => {\n                    // #ifdef MP-WEIXIN\n                    img.onload = () => {\n                        resolve(img);\n                    }\n                    img.onerror = () => {\n                        reject(2);\n                    }\n                    // #endif\n                    // #ifndef MP-WEIXIN\n                    uni.downloadFile({\n                        url: img,\n                        success(res) {\n                            resolve(res.tempFilePath);\n                        },\n                        fail(res) {\n                            reject(2);\n                        }\n                    })\n                    // #endif\n                })\n            },\n\n            async createdImg(canvas, ctx, url, x, y, w, h, color, is_radius = false) {\n                // #ifdef MP-WEIXIN\n                let img = canvas.createImage();\n                img.src = url;\n                await this.imgLoad(img).then(e => {\n                    ctx.beginPath();\n                    if (is_radius) {\n                        ctx.arc(w / 2 + x, h / 2 + y, w / 2, 0, Math.PI * 2, false);\n                        ctx.strokeStyle = color;\n                        ctx.stroke();\n                        ctx.clip();\n                    }\n                    ctx.drawImage(img, x, y, w, h);\n                    ctx.restore();\n                    ctx.closePath();\n                    ctx.save();\n                });\n                // #endif\n                // #ifndef MP-WEIXIN\n                await this.imgLoad(url).then(e => {\n                    ctx.strokeStyle = color;\n                    ctx.save();\n                    ctx.beginPath();\n                    if (is_radius) {\n                        ctx.arc(w / 2 + x, h / 2 + y, w / 2, 0, Math.PI * 2, false);\n                        ctx.stroke();\n                        ctx.clip();\n                    }\n                    ctx.drawImage(e, x, y, w, h);\n                    ctx.restore();\n                    ctx.closePath();\n                });\n                // #endif\n            },\n            createdText(canvas, ctx, text, x, y, font, textAlign, color) {\n                // #ifdef MP-WEIXIN\n                ctx.beginPath();\n                ctx.textAlign = textAlign;\n                ctx.font = font;\n                ctx.fillStyle = color;\n                ctx.fillText(text, x, y); // 需要算上文字的高度\n                ctx.stroke();\n                ctx.closePath();\n                ctx.save();\n                // #endif\n                // #ifndef MP-WEIXIN\n                ctx.textAlign = textAlign;\n                ctx.font = font;\n                ctx.fillStyle = color;\n                ctx.fillText(text, x, y); // 需要算上文字的高度\n                ctx.stroke();\n                // #endif\n            },\n            createdEllipse(canvas, ctx, x, y, w, h, color) {\n                let r = h / 2; // 圆半径\n                let l_w = Math.abs(w - h); // 线长度\n                // #ifdef MP-WEIXIN\n                ctx.beginPath();\n                ctx.moveTo(x+r, y);           // 创建开始点\n                ctx.lineTo(x+r+l_w,y);          // 创建水平线\n                ctx.arcTo(x+w,y,x+w,y+r,r); // 创建弧\n                ctx.arcTo(x+w,y+h,x+r+l_w,y+h,r); // 创建弧\n                ctx.lineTo(x+r,y+h);         // 创建垂直线\n                ctx.arcTo(x,y+h,x,y+r,r); // 创建弧\n                ctx.arcTo(x,y,x+r,y,r); // 创建弧\n                ctx.strokeStyle = 'rgba(0, 0, 0, 0)';\n                ctx.stroke();\n                ctx.clip();\n                ctx.fillStyle = color;\n                ctx.fill();\n                ctx.restore();\n                ctx.closePath();\n                ctx.save();\n                // #endif\n                // #ifndef MP-WEIXIN\n                ctx.strokeStyle = 'rgba(0, 0, 0, 0)';\n                ctx.save();\n                ctx.beginPath();\n                ctx.moveTo(x+r, y);           // 创建开始点\n                ctx.lineTo(x+r+l_w,y);          // 创建水平线\n                ctx.arcTo(x+w,y,x+w,y+r,r); // 创建弧\n                ctx.arcTo(x+w,y+h,x+r+l_w,y+h,r); // 创建弧\n                ctx.lineTo(x+r,y+h);         // 创建垂直线\n                ctx.arcTo(x,y+h,x,y+r,r); // 创建弧\n                ctx.arcTo(x,y,x+r,y,r); // 创建弧\n                ctx.stroke();\n                ctx.clip();\n                ctx.fillStyle = color;\n                ctx.fill();\n                ctx.restore();\n                ctx.closePath();\n                // #endif\n            },\n            async created(canvas, ctx, rpx) {\n                let color = '#353535';\n                let font_fimaly = 'sans-serif';\n                // 背景图\n                await this.createdImg(canvas, ctx, this.info.poster_bg , 0, 0, 750*rpx, 1334*rpx, 'white', false);\n\n                // 头像\n                await this.createdImg(canvas, ctx, this.info.avatar , 310*rpx, 66*rpx, 130*rpx, 130*rpx, 'white', true);\n\n                // 名称\n                this.createdText(canvas, ctx, this.info.nickname, 376*rpx, 252*rpx, 28*rpx + 'px ' + font_fimaly, 'center', 'white');\n\n                if (this.card_id > 0) {\n                    // 卡券图片\n                    await this.createdImg(canvas, ctx, this.info.pic_url , 76*rpx, 394*rpx, 120*rpx, 120*rpx, 'white', true);\n\n                    // 卡券名称\n                    let name = this.info.name;\n                    let font = 33*rpx + 'px ' + font_fimaly;\n                    if (name.length > 20) {\n                        this.createdText(canvas, ctx, name.substring(0,10), 220*rpx, 439*rpx, font, 'left', color);\n                        this.createdText(canvas, ctx, name.substring(11,20) + '...', 220*rpx, 490*rpx, font, 'left', color);\n                    } else if (name.length > 10) {\n                        this.createdText(canvas, ctx, name.substring(0,10), 220*rpx, 439*rpx, font, 'left', color);\n                        this.createdText(canvas, ctx, name.substring(11,name.length), 220*rpx, 490*rpx, font, 'left', color);\n                    } else {\n                        this.createdText(canvas, ctx, name, 220*rpx, 465*rpx, font, 'left', color);\n                    }\n                } else {\n                    // 优惠方式\n                    if (this.info.type === 1) {\n                        this.createdText(canvas, ctx, this.info.discount, 100*rpx, 470*rpx, 58*rpx + 'px ' + font_fimaly, 'left', 'white');\n                        this.createdText(canvas, ctx, '折', 185*rpx, 470*rpx, 33*rpx + 'px ' + font_fimaly, 'left', 'white');\n                    } else {\n                        let x = 129;\n                        let length = (this.info.sub_price + '').length;\n                        if (length > 1) {\n                            x -= (length - 1) * 15;\n                        }\n                        this.createdText(canvas, ctx, '￥', x*rpx, 470*rpx, 33*rpx + 'px ' + font_fimaly, 'left', 'white');\n                        this.createdText(canvas, ctx, this.info.sub_price, (x+30)*rpx, 470*rpx, 58*rpx + 'px ' + font_fimaly, 'left', 'white');\n                    }\n                    // 门槛\n                    let min_price = '无门槛使用';\n                    if(this.info.min_price > 0) {\n                        min_price = '满'+this.info.min_price+'可用'\n                    }\n                    this.createdText(canvas, ctx, min_price, 286*rpx, 439*rpx, 33*rpx + 'px ' + font_fimaly, 'left', color);\n                    // 使用场景\n                    this.createdText(canvas, ctx, this.info.appoint_type, 286*rpx, 490*rpx, 28*rpx + 'px ' + font_fimaly, 'left', color);\n                    // 有效日期\n                    let day = '';\n                    if (this.info.expire_type == 1) {\n                        day = `有效期：领取后${this.info.expire_day}天内有效`\n                    } else {\n                        day = `有效期：${this.info.begin_time}-${this.info.end_time}`;\n                    }\n                    let text_font = parseInt(24*rpx);\n                    ctx.font = text_font + 'px ' + font_fimaly;\n                    let text_w = ctx.measureText(day).width;\n                    this.createdEllipse(canvas, ctx, (750*rpx- text_w)/2-text_font, 882*rpx, text_w+48*rpx, 60*rpx, 'rgba(0, 0, 0, 0.2)');\n                    this.createdText(canvas, ctx, day, 375*rpx, 920*rpx, text_font + 'px ' + font_fimaly, 'center', 'white');\n                }\n                // 二维码\n                await this.createdImg(canvas, ctx, this.info.qrcode , 255*rpx, 964*rpx, 240*rpx, 240*rpx, 'white', true);\n                ctx.draw();\n                return null;\n            },\n            submitSave() {\n                const self = this;\n                self.$showLoading({text: `正在保存图片`});\n                uni.canvasToTempFilePath({\n                  canvas: self.canvas,\n                  success: function(res) {\n                    // 在H5平台下，tempFilePath 为 base64\n                    uni.getImageInfo({\n                        src: res.tempFilePath,\n                        success: function (e) {\n                            uni.saveImageToPhotosAlbum({\n                                filePath: e.path,\n                                success: function () {\n                                    uni.showToast({title: '保存成功'});\n                                },\n                                fail: function (err) {\n                                    if (err.errMsg) {\n                                        uni.showModal({\n                                            title: '提示',\n                                            content: '您好,请先授权保存到相册权限',\n                                            showCancel: false,\n                                            success(res) {\n                                                if (res.confirm) {\n                                                    uni.openSetting({\n                                                        success(settingdata) {\n                                                            if (settingdata.authSetting['scope.writePhotosAlbum']) {\n                                                                uni.saveImageToPhotosAlbum({\n                                                                    filePath: e.path,\n                                                                    success: function () {\n                                                                        uni.showToast({title: '保存成功'});\n                                                                    },\n                                                                })\n                                                            } else {\n                                                                uni.showModal({\n                                                                    title: '提示',\n                                                                    content: '授权失败，请稍后重新获取',\n                                                                    showCancel: false,\n                                                                })\n                                                            }\n                                                        }\n                                                    })\n                                                }\n                                            }\n                                        })\n                                    }\n                                },\n                                complete: function (e) {\n                                    self.$hideLoading();\n                                }\n                            });\n                        },\n                        fail: function (e) {\n                            uni.showModal({\n                                title: '图片下载失败',\n                                content: e.errMsg,\n                                showCancel: false,\n                            });\n                        },\n                        complete: function (e) {\n                            self.$hideLoading();\n                        }\n                    });\n                  }\n                })\n            },\n            getList() {\n                let that = this;\n                let url;\n                let para;\n                if(that.card_id > 0) {\n                    url = that.$api.poster.card;\n                    para = {\n                        cardId: that.card_id\n                    }\n                }\n                if(that.coupon_id > 0) {\n                    url = that.$api.poster.coupon;\n                    para = {\n                        coupon_id: that.coupon_id\n                    }\n                }\n                that.$request({\n                    url: url,\n                    data: para\n                }).then(response=>{\n                    if(response.code == 0) {\n                        that.info = response.data;\n                        that.$hideLoading();\n                        setTimeout(() => {\n                            const query = uni.createSelectorQuery()\n                            query.select('#poster')\n                                .fields({ node: true, size: true })\n                                .exec((res) => {\n                                    const dpr = uni.getSystemInfoSync().pixelRatio\n                                    // #ifdef MP-WEIXIN\n                                    that.canvas = res[0].node\n                                    const ctx = that.canvas.getContext('2d')\n                                    that.canvas.width = res[0].width * dpr\n                                    that.canvas.height = res[0].height * dpr\n                                    // #endif\n                                    // #ifndef MP-WEIXIN\n                                    that.canvas = uni.createCanvasContext('poster');\n                                    const ctx = that.canvas;\n                                    // #endif\n                                    ctx.scale(dpr, dpr)\n                                    that.created(that.canvas,ctx, 0.4);\n                                }\n                            )\n                        }, 100);\n                    }else {\n                        that.$hideLoading();\n                        uni.showToast({\n                            title: response.msg,\n                            icon: 'none',\n                            duration: 1000\n                        });\n                    }\n                }).catch(response => {\n                    that.$hideLoading();\n                });\n            },\n        },\n\n        onLoad(options) {\n            let that = this;\n            this.dpr = uni.getSystemInfoSync().pixelRatio\n            if(options.card_id > 0) {\n                that.card_id = options.card_id\n            }\n            if(options.coupon_id > 0) {\n                that.coupon_id = options.coupon_id\n            }\n            uni.getSystemInfo({\n                success(res) {\n                  that.rpx = res.windowWidth/375;\n                },\n            })\n            that.$showLoading({text: '生成中'});\n            that.getList();\n        }\n    }\n</script>\n\n<style scoped lang=\"scss\">\n    .poster {\n        .poster {\n            width: 1500rpx;\n            height: 2668rpx;\n            position: fixed;\n            left: 100%;\n            top: 150%;\n        }\n        .head {\n            width: 100%;\n            view {\n                margin: 50rpx auto;\n            }\n        }\n\n        .button {\n            font-size: #{32rpx};\n            border-radius: #{40rpx};\n            height: #{68rpx};\n            margin: 0 auto #{50rpx};\n            color: #ffffff;\n            width: #{500rpx};\n        }\n    }\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./poster.vue?vue&type=style&index=0&id=132a9d26&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./poster.vue?vue&type=style&index=0&id=132a9d26&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1618143829541\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}