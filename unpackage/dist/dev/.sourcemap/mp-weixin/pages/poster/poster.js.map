{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/26439/Desktop/shop4.3.57_1/pages/poster/poster.vue?1640","webpack:///C:/Users/26439/Desktop/shop4.3.57_1/pages/poster/poster.vue?bf71","webpack:///C:/Users/26439/Desktop/shop4.3.57_1/pages/poster/poster.vue?e3dc","webpack:///C:/Users/26439/Desktop/shop4.3.57_1/pages/poster/poster.vue?aa56","uni-app:///pages/poster/poster.vue","webpack:///C:/Users/26439/Desktop/shop4.3.57_1/pages/poster/poster.vue?b5e8","webpack:///C:/Users/26439/Desktop/shop4.3.57_1/pages/poster/poster.vue?fba2"],"names":["createPage","Page"],"mappings":"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","file":"pages/poster/poster.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/poster/poster.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./poster.vue?vue&type=template&id=132a9d26&scoped=true&\"\nvar renderjs\nimport script from \"./poster.vue?vue&type=script&lang=js&\"\nexport * from \"./poster.vue?vue&type=script&lang=js&\"\nimport style0 from \"./poster.vue?vue&type=style&index=0&id=132a9d26&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"132a9d26\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/poster/poster.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./poster.vue?vue&type=template&id=132a9d26&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./poster.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./poster.vue?vue&type=script&lang=js&\"","<template>\r\n    <app-layout>\r\n        <view class=\"poster\">\r\n            <view id=\"head\" class=\"head\">\r\n                <view class=\"main-center cross-center\">\r\n                    <!-- #ifdef MP-WEIXIN -->\r\n                    <canvas type=\"2d\" id=\"poster\" style=\"width: 300px; height: 533.6px;\"></canvas>\r\n                    <!-- #endif -->\r\n                    <!-- #ifndef MP-WEIXIN -->\r\n                    <canvas id=\"poster\" :width=\"300*dpr\" :height=\"533.6*dpr\" style=\"width: 300px; height: 533.6px;\"></canvas>\r\n                    <!-- #endif -->\r\n                </view>\r\n            </view>\r\n            <view class=\"button main-center cross-center\" @click=\"submitSave\"\r\n                  :class=\"getTheme + '-m-back ' + getTheme\">保存图片\r\n            </view>\r\n        </view>\r\n    </app-layout>\r\n</template>\r\n\r\n<script>\r\n    import { mapState,mapGetters } from \"vuex\";\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                card_id: 0,\r\n                coupon_id: 0,\r\n                rpx: 1,\r\n                show: false,\r\n                info: {},\r\n                canvas: null,\r\n                dpr: 2,\r\n            }\r\n        },\r\n        computed: {\r\n            ...mapGetters('mallConfig', {\r\n                getTheme: 'getTheme',\r\n            }),\r\n            ...mapState({\r\n                poster_img: state => state.mallConfig.__wxapp_img.poster,\r\n            })\r\n        },\r\n        methods: {\r\n            imgLoad(img) {\r\n                return new Promise((resolve, reject) => {\r\n                    // #ifdef MP-WEIXIN\r\n                    img.onload = () => {\r\n                        resolve(img);\r\n                    }\r\n                    img.onerror = () => {\r\n                        reject(2);\r\n                    }\r\n                    // #endif\r\n                    // #ifndef MP-WEIXIN\r\n                    uni.downloadFile({\r\n                        url: img,\r\n                        success(res) {\r\n                            resolve(res.tempFilePath);\r\n                        },\r\n                        fail(res) {\r\n                            reject(2);\r\n                        }\r\n                    })\r\n                    // #endif\r\n                })\r\n            },\r\n\r\n            async createdImg(canvas, ctx, url, x, y, w, h, color, is_radius = false) {\r\n                // #ifdef MP-WEIXIN\r\n                let img = canvas.createImage();\r\n                img.src = url;\r\n                await this.imgLoad(img).then(e => {\r\n                    ctx.beginPath();\r\n                    if (is_radius) {\r\n                        ctx.arc(w / 2 + x, h / 2 + y, w / 2, 0, Math.PI * 2, false);\r\n                        ctx.strokeStyle = color;\r\n                        ctx.stroke();\r\n                        ctx.clip();\r\n                    }\r\n                    ctx.drawImage(img, x, y, w, h);\r\n                    ctx.restore();\r\n                    ctx.closePath();\r\n                    ctx.save();\r\n                });\r\n                // #endif\r\n                // #ifndef MP-WEIXIN\r\n                await this.imgLoad(url).then(e => {\r\n                    ctx.strokeStyle = color;\r\n                    ctx.save();\r\n                    ctx.beginPath();\r\n                    if (is_radius) {\r\n                        ctx.arc(w / 2 + x, h / 2 + y, w / 2, 0, Math.PI * 2, false);\r\n                        ctx.stroke();\r\n                        ctx.clip();\r\n                    }\r\n                    ctx.drawImage(e, x, y, w, h);\r\n                    ctx.restore();\r\n                    ctx.closePath();\r\n                });\r\n                // #endif\r\n            },\r\n            createdText(canvas, ctx, text, x, y, font, textAlign, color) {\r\n                // #ifdef MP-WEIXIN\r\n                ctx.beginPath();\r\n                ctx.textAlign = textAlign;\r\n                ctx.font = font;\r\n                ctx.fillStyle = color;\r\n                ctx.fillText(text, x, y); // 需要算上文字的高度\r\n                ctx.stroke();\r\n                ctx.closePath();\r\n                ctx.save();\r\n                // #endif\r\n                // #ifndef MP-WEIXIN\r\n                ctx.textAlign = textAlign;\r\n                ctx.font = font;\r\n                ctx.fillStyle = color;\r\n                ctx.fillText(text, x, y); // 需要算上文字的高度\r\n                ctx.stroke();\r\n                // #endif\r\n            },\r\n            createdEllipse(canvas, ctx, x, y, w, h, color) {\r\n                let r = h / 2; // 圆半径\r\n                let l_w = Math.abs(w - h); // 线长度\r\n                // #ifdef MP-WEIXIN\r\n                ctx.beginPath();\r\n                ctx.moveTo(x+r, y);           // 创建开始点\r\n                ctx.lineTo(x+r+l_w,y);          // 创建水平线\r\n                ctx.arcTo(x+w,y,x+w,y+r,r); // 创建弧\r\n                ctx.arcTo(x+w,y+h,x+r+l_w,y+h,r); // 创建弧\r\n                ctx.lineTo(x+r,y+h);         // 创建垂直线\r\n                ctx.arcTo(x,y+h,x,y+r,r); // 创建弧\r\n                ctx.arcTo(x,y,x+r,y,r); // 创建弧\r\n                ctx.strokeStyle = 'rgba(0, 0, 0, 0)';\r\n                ctx.stroke();\r\n                ctx.clip();\r\n                ctx.fillStyle = color;\r\n                ctx.fill();\r\n                ctx.restore();\r\n                ctx.closePath();\r\n                ctx.save();\r\n                // #endif\r\n                // #ifndef MP-WEIXIN\r\n                ctx.strokeStyle = 'rgba(0, 0, 0, 0)';\r\n                ctx.save();\r\n                ctx.beginPath();\r\n                ctx.moveTo(x+r, y);           // 创建开始点\r\n                ctx.lineTo(x+r+l_w,y);          // 创建水平线\r\n                ctx.arcTo(x+w,y,x+w,y+r,r); // 创建弧\r\n                ctx.arcTo(x+w,y+h,x+r+l_w,y+h,r); // 创建弧\r\n                ctx.lineTo(x+r,y+h);         // 创建垂直线\r\n                ctx.arcTo(x,y+h,x,y+r,r); // 创建弧\r\n                ctx.arcTo(x,y,x+r,y,r); // 创建弧\r\n                ctx.stroke();\r\n                ctx.clip();\r\n                ctx.fillStyle = color;\r\n                ctx.fill();\r\n                ctx.restore();\r\n                ctx.closePath();\r\n                // #endif\r\n            },\r\n            async created(canvas, ctx, rpx) {\r\n                let color = '#353535';\r\n                let font_fimaly = 'sans-serif';\r\n                // 背景图\r\n                await this.createdImg(canvas, ctx, this.info.poster_bg , 0, 0, 750*rpx, 1334*rpx, 'white', false);\r\n\r\n                // 头像\r\n                await this.createdImg(canvas, ctx, this.info.avatar , 310*rpx, 66*rpx, 130*rpx, 130*rpx, 'white', true);\r\n\r\n                // 名称\r\n                this.createdText(canvas, ctx, this.info.nickname, 376*rpx, 252*rpx, 28*rpx + 'px ' + font_fimaly, 'center', 'white');\r\n\r\n                if (this.card_id > 0) {\r\n                    // 卡券图片\r\n                    await this.createdImg(canvas, ctx, this.info.pic_url , 76*rpx, 394*rpx, 120*rpx, 120*rpx, 'white', true);\r\n\r\n                    // 卡券名称\r\n                    let name = this.info.name;\r\n                    let font = 33*rpx + 'px ' + font_fimaly;\r\n                    if (name.length > 20) {\r\n                        this.createdText(canvas, ctx, name.substring(0,10), 220*rpx, 439*rpx, font, 'left', color);\r\n                        this.createdText(canvas, ctx, name.substring(11,20) + '...', 220*rpx, 490*rpx, font, 'left', color);\r\n                    } else if (name.length > 10) {\r\n                        this.createdText(canvas, ctx, name.substring(0,10), 220*rpx, 439*rpx, font, 'left', color);\r\n                        this.createdText(canvas, ctx, name.substring(11,name.length), 220*rpx, 490*rpx, font, 'left', color);\r\n                    } else {\r\n                        this.createdText(canvas, ctx, name, 220*rpx, 465*rpx, font, 'left', color);\r\n                    }\r\n                } else {\r\n                    // 优惠方式\r\n                    if (this.info.type === 1) {\r\n                        this.createdText(canvas, ctx, this.info.discount, 100*rpx, 470*rpx, 58*rpx + 'px ' + font_fimaly, 'left', 'white');\r\n                        this.createdText(canvas, ctx, '折', 185*rpx, 470*rpx, 33*rpx + 'px ' + font_fimaly, 'left', 'white');\r\n                    } else {\r\n                        let x = 129;\r\n                        let length = (this.info.sub_price + '').length;\r\n                        if (length > 1) {\r\n                            x -= (length - 1) * 15;\r\n                        }\r\n                        this.createdText(canvas, ctx, '￥', x*rpx, 470*rpx, 33*rpx + 'px ' + font_fimaly, 'left', 'white');\r\n                        this.createdText(canvas, ctx, this.info.sub_price, (x+30)*rpx, 470*rpx, 58*rpx + 'px ' + font_fimaly, 'left', 'white');\r\n                    }\r\n                    // 门槛\r\n                    let min_price = '无门槛使用';\r\n                    if(this.info.min_price > 0) {\r\n                        min_price = '满'+this.info.min_price+'可用'\r\n                    }\r\n                    this.createdText(canvas, ctx, min_price, 286*rpx, 439*rpx, 33*rpx + 'px ' + font_fimaly, 'left', color);\r\n                    // 使用场景\r\n                    this.createdText(canvas, ctx, this.info.appoint_type, 286*rpx, 490*rpx, 28*rpx + 'px ' + font_fimaly, 'left', color);\r\n                    // 有效日期\r\n                    let day = '';\r\n                    if (this.info.expire_type == 1) {\r\n                        day = `有效期：领取后${this.info.expire_day}天内有效`\r\n                    } else {\r\n                        day = `有效期：${this.info.begin_time}-${this.info.end_time}`;\r\n                    }\r\n                    let text_font = parseInt(24*rpx);\r\n                    ctx.font = text_font + 'px ' + font_fimaly;\r\n                    let text_w = ctx.measureText(day).width;\r\n                    this.createdEllipse(canvas, ctx, (750*rpx- text_w)/2-text_font, 882*rpx, text_w+48*rpx, 60*rpx, 'rgba(0, 0, 0, 0.2)');\r\n                    this.createdText(canvas, ctx, day, 375*rpx, 920*rpx, text_font + 'px ' + font_fimaly, 'center', 'white');\r\n                }\r\n                // 二维码\r\n                await this.createdImg(canvas, ctx, this.info.qrcode , 255*rpx, 964*rpx, 240*rpx, 240*rpx, 'white', true);\r\n                ctx.draw();\r\n                return null;\r\n            },\r\n            submitSave() {\r\n                const self = this;\r\n                self.$showLoading({text: `正在保存图片`});\r\n                uni.canvasToTempFilePath({\r\n                  canvas: self.canvas,\r\n                  success: function(res) {\r\n                    // 在H5平台下，tempFilePath 为 base64\r\n                    uni.getImageInfo({\r\n                        src: res.tempFilePath,\r\n                        success: function (e) {\r\n                            uni.saveImageToPhotosAlbum({\r\n                                filePath: e.path,\r\n                                success: function () {\r\n                                    uni.showToast({title: '保存成功'});\r\n                                },\r\n                                fail: function (err) {\r\n                                    if (err.errMsg) {\r\n                                        uni.showModal({\r\n                                            title: '提示',\r\n                                            content: '您好,请先授权保存到相册权限',\r\n                                            showCancel: false,\r\n                                            success(res) {\r\n                                                if (res.confirm) {\r\n                                                    uni.openSetting({\r\n                                                        success(settingdata) {\r\n                                                            if (settingdata.authSetting['scope.writePhotosAlbum']) {\r\n                                                                uni.saveImageToPhotosAlbum({\r\n                                                                    filePath: e.path,\r\n                                                                    success: function () {\r\n                                                                        uni.showToast({title: '保存成功'});\r\n                                                                    },\r\n                                                                })\r\n                                                            } else {\r\n                                                                uni.showModal({\r\n                                                                    title: '提示',\r\n                                                                    content: '授权失败，请稍后重新获取',\r\n                                                                    showCancel: false,\r\n                                                                })\r\n                                                            }\r\n                                                        }\r\n                                                    })\r\n                                                }\r\n                                            }\r\n                                        })\r\n                                    }\r\n                                },\r\n                                complete: function (e) {\r\n                                    self.$hideLoading();\r\n                                }\r\n                            });\r\n                        },\r\n                        fail: function (e) {\r\n                            uni.showModal({\r\n                                title: '图片下载失败',\r\n                                content: e.errMsg,\r\n                                showCancel: false,\r\n                            });\r\n                        },\r\n                        complete: function (e) {\r\n                            self.$hideLoading();\r\n                        }\r\n                    });\r\n                  }\r\n                })\r\n            },\r\n            getList() {\r\n                let that = this;\r\n                let url;\r\n                let para;\r\n                if(that.card_id > 0) {\r\n                    url = that.$api.poster.card;\r\n                    para = {\r\n                        cardId: that.card_id\r\n                    }\r\n                }\r\n                if(that.coupon_id > 0) {\r\n                    url = that.$api.poster.coupon;\r\n                    para = {\r\n                        coupon_id: that.coupon_id\r\n                    }\r\n                }\r\n                that.$request({\r\n                    url: url,\r\n                    data: para\r\n                }).then(response=>{\r\n                    if(response.code == 0) {\r\n                        that.info = response.data;\r\n                        that.$hideLoading();\r\n                        setTimeout(() => {\r\n                            const query = uni.createSelectorQuery()\r\n                            query.select('#poster')\r\n                                .fields({ node: true, size: true })\r\n                                .exec((res) => {\r\n                                    const dpr = uni.getSystemInfoSync().pixelRatio\r\n                                    // #ifdef MP-WEIXIN\r\n                                    that.canvas = res[0].node\r\n                                    const ctx = that.canvas.getContext('2d')\r\n                                    that.canvas.width = res[0].width * dpr\r\n                                    that.canvas.height = res[0].height * dpr\r\n                                    // #endif\r\n                                    // #ifndef MP-WEIXIN\r\n                                    that.canvas = uni.createCanvasContext('poster');\r\n                                    const ctx = that.canvas;\r\n                                    // #endif\r\n                                    ctx.scale(dpr, dpr)\r\n                                    that.created(that.canvas,ctx, 0.4);\r\n                                }\r\n                            )\r\n                        }, 100);\r\n                    }else {\r\n                        that.$hideLoading();\r\n                        uni.showToast({\r\n                            title: response.msg,\r\n                            icon: 'none',\r\n                            duration: 1000\r\n                        });\r\n                    }\r\n                }).catch(response => {\r\n                    that.$hideLoading();\r\n                });\r\n            },\r\n        },\r\n\r\n        onLoad(options) {\r\n            let that = this;\r\n            this.dpr = uni.getSystemInfoSync().pixelRatio\r\n            if(options.card_id > 0) {\r\n                that.card_id = options.card_id\r\n            }\r\n            if(options.coupon_id > 0) {\r\n                that.coupon_id = options.coupon_id\r\n            }\r\n            uni.getSystemInfo({\r\n                success(res) {\r\n                  that.rpx = res.windowWidth/375;\r\n                },\r\n            })\r\n            that.$showLoading({text: '生成中'});\r\n            that.getList();\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n    .poster {\r\n        .poster {\r\n            width: 1500rpx;\r\n            height: 2668rpx;\r\n            position: fixed;\r\n            left: 100%;\r\n            top: 150%;\r\n        }\r\n        .head {\r\n            width: 100%;\r\n            view {\r\n                margin: 50rpx auto;\r\n            }\r\n        }\r\n\r\n        .button {\r\n            font-size: #{32rpx};\r\n            border-radius: #{40rpx};\r\n            height: #{68rpx};\r\n            margin: 0 auto #{50rpx};\r\n            color: #ffffff;\r\n            width: #{500rpx};\r\n        }\r\n    }\r\n</style>\r\n","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./poster.vue?vue&type=style&index=0&id=132a9d26&scoped=true&lang=scss&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./poster.vue?vue&type=style&index=0&id=132a9d26&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1611297816533\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}